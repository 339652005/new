var ISCTRIP=Cookie.read("IsFromCtrip");var LOGIN={isLogin:0,passportUrl:"http://passport.95171.cn/",detectPage:"/member/docommon.aspx",infPage:"/juser.aspx",siteUrl:"",json:{},appendHtml:'<span class="head_a">个人信息加载中...</span>',container:$("rightNavDiv"),callback:$empty,mboxcall:$empty,onError:$empty,account:"",appload:function(a){a=a||"";$loadScript(this.passportUrl.replace(/\/$/,"")+"/appusernew.aspx?"+a+"k="+$time(),function(){this.jsonDeal()}.bind(this));return this},auto:function(){this.appload();return this},out:function(){this.appload("a=o&");return this},login:function(b,a,c){b=b.cnEncode()||"",c=c||false;a=a.cnEncode()||"";this.appload("a=l&n="+b+"&p="+a+"&r="+c+"&");return this},regist:function(d,c,f,e,b){if((!d&&!c)||!f){return}var a="",c=c||"",e=e||"",b=b||"";a+="&m="+c+"&sex="+e+"'&nickname="+b.cnEncode();this.appload("a=r&e="+d+a+"&p="+f+"&");return this},password:function(a){a=a||"";this.appload("a=changepassword&p="+a+"&");return this},findpwd:function(b,c,a){if(!b||!c){return}this.appload("a=f&Mobile="+b+"&Code="+c+"&guid="+a+"&");return this},jsonDeal:function(){var a=this.json.code;if(a===200){this.detect("clogin")}else{if(a>=304&&a<=320){this.jsonLoginError()}else{if(a===500){this.detect("login")}else{if(a>600&&a<700){this.jsonFindPwd()}else{if(a>=1100&&a<1199){this.jsonChgPwd()}else{this.nologinHtml().append().eventBind().isLogin=0}}}}}return this},jsonFindPwd:function(){if(this.json.code===604){Mbox.alert(this.json.msg,null,{onClose:function(){this.mboxLogin()}.bind(this)})}else{alert(this.json.msg);this.onError()}return this},jsonLoginError:function(){alert(this.json.msg);this.onError()},jsonChgPwd:function(){},detect:function(c){var b=this.json.u&&this.json.u.token,a=this;new AjaxReq({url:this.detectPage,async:true,method:"post",callType:"html",data:{"do":c,token:b||"",k:$time()},onSuccess:function(e){var d=this.ajax.response.html;if(d=="0"){a.detect("login")}else{if(d=="1"){a.infLoad();if($isFun(a.callback)){a.callback()}}}}}).send();return this},infLoad:function(){var a=this;new AjaxReq({url:this.infPage,data:{r:$time()},onSuccess:function(b){if(b.code===200&&b.u){a.loginHtml(b.u).append().eventBind(b).isLogin=1}else{a.nologinHtml().append().eventBind(b).isLogin=0}}}).send();return this},loginHtml:function(c){var e="",a="",d=' rel="nofollow"',b='<a href="'+this.siteUrl+'/member/order/" class="head_a ml10"'+d+">我的订单</a>";if(c.neworder.toInt()){b='<a href="'+this.siteUrl+'/member/order/" class="c7e ml10"'+d+">我的订单("+c.neworder+")</a>"}if(c.isshow&&c.msgcount.toInt()){e='<span id="headMsgBox" class="yellow_bar head_msg"><a href="'+this.siteUrl+'/member/inbox.aspx" class="g3" title="查看"><span class="co">'+c.msgcount+'</span> 封未读短信</a><a href="javascript:" id="headMsgClose" class="aclose ml20" title="我知道了">×</a></span>'}if(c.bind&&c.bind.length){if(c.bind.length===1){if(c.bind.indexOf("sina")!==-1){a='<u class="u u215" title="已绑定新浪微博"></u>'}else{if(c.bind.indexOf("qq")!==-1){a='<u class="u u313" title="已绑定QQ账号"></u>'}}}else{if(c.bind.length===2){a='<span id="headBindView" class="poi dib" rel="headBindViewBox"><u class="u u215 rel"></u><i class="cor corwh ml2"></i></span><div id="headBindViewBox" class="bgbl p1 abs_out"><div class="bgwh pl10 pr10 pb5 pt5 nowrap"><p class="g3">已绑定</p><ul class="mt2 g6 ml-3"><li class="pb2"><u class="u u15 mr2"></u>新浪微博账户</li><li class="pb2"><u class="u u315 mr2"></u>QQ账户</li></ul></div></div>'}}}this.appendHtml=e+'<span class="ml5">您好！<a target="_blank" href="'+this.siteUrl+'/member/" class="head_a">'+c.nickname+"</a></span>"+a+b+'<a href="'+this.siteUrl+'/member/account/MyPoints.aspx" class="head_a ml10"'+d+'>我的积分</a><a href="'+this.siteUrl+'/award" class="head_a ml10"'+d+'>积分奖励</a><a href="'+this.siteUrl+'/member/" class="head_a ml10"'+d+'>会员中心</a><a href="/member/do.aspx?action=logout" class="head_a ml10"'+d+">退出</a>";return this},nologinHtml:function(){var a=' rel="nofollow"';this.appendHtml='<a href="javascript:" id="headLogin" class="ml5 head_a"'+a+'>登录</a><a href="/member/do.aspx?action=reg" class="ml10 head_a" target="_blank"'+a+'>快速注册</a><a href="/member/do.aspx?action=loginbycode" class="head_a ml10"'+a+'>我的订单</a><a href="'+this.siteUrl+'/award" class="head_a ml10"'+a+'>积分奖励</a><a href="javascript:" id="headPassword" class="head_a ml10"'+a+">找回密码</a>";return this},mboxLogin:function(){if(LOGIN.cookieName&&Cookie.read(LOGIN.cookieName)){Mbox.alert("您已经登录。",null,{onClose:function(){$pageFresh()}})}else{Mbox.open({url:this.mboxLoginUrl||"/shop/LoginWindow.aspx?r="+$time()+"&account="+this.account,ajax:true,type:"ajax",title:"会员登录"})}return this},mboxPassword:function(){Mbox.open({url:this.mboxPasswordUrl||"/shop/GetPasswordWindow.aspx?r="+$time()+"&account="+this.account,ajax:true,type:"ajax",title:"找回密码"});return this},mboxChgPassword:function(){Mbox.open({url:"",ajax:true,type:"ajax",title:"修改密码"});return this},mboxSetPassword:function(b,a){if(!b){return}Mbox.open({url:"/shop/passwordset.aspx?username="+b+"&token="+a+"&r="+$time(),ajax:true,type:"ajax",title:"完善注册信息"});return this},eventBind:function(e){this.jsonUserInf=e;var a=$("headLogin"),c=$("headPassword"),f=$("headMsgBox"),b=$("headMsgClose"),d=$("headBindView");if(a){a.addEvent("click",function(){this.mboxLogin()}.bind(this))}if(c){c.addEvent("click",function(){this.mboxPassword()}.bind(this))}if(f&&b){b.addEvent("click",function(){f.dispose();new AjaxReq({url:"/JuserAjax.aspx",method:"post"}).send()});$smartFloat(f)}if(d){$powerFloat(d,{offsets:{x:0,y:6},position:"3-2"})}if(e&&e.appMobileMsg){$$("#appMsgBox").html('<div class="yellow_bar app_msg appMsgBox"><span class="app_msg_cor_1">◆</span><span class="app_msg_cor_2">◆</span><a href="javascript:" class="aclose r mt-2 appMsgClose" title="我知道了">×</a><img class="l mr10" src="'+URLHOST+'/b/img/app_icon.v2.png" /><p class="cell pr10 b g3">'+e.appMobileMsg+"</p></div>")}$$(".appMsgClose").addEvent("click",function(){var g=this.attr("data-url")||"/JuserAjax.aspx?act=closemobile";new AjaxReq({url:g,method:"post"}).send();this.getParent().dispose();return false});return this},append:function(){this.container.html(this.appendHtml);return this},init:function(){if(this.container){this.append().auto()}}};var $focusRemind=function(b,a){if($isArr(b)||($isEle(b)&&(b=[b]))){b.each(function(c){$powerFloat(c,$extend({width:250,offsets:{x:10,y:0},targetMode:"account",eventType:"focus",target:'<div class="bgf0 p5 pl10 g6 bdd">'+c.attr("data-remind")+"</div>",position:"6-8"},a||{}))})}window.addEvent("resize",function(){$$("#floatBox_account").out()})};var $firstInputFocus=function(b){var a=false;if($isEle(b)){b.getElements("input").each(function(c){if(!a&&(!c.val().trim()||c.attr("type")==="submit")&&c.isDisplayed()){c.focus();a=true}})}};var $accountExist=function(a){if($isArr(a)||($isEle(a)&&(a=[a]))){new Elements(a).addEvents({change:function(){setTimeout(function(){this.fireEvent("exist")}.bind(this),200)},exist:function(){var c=this.val(),b={};if(c&&$accountExist.verify){b[this.name]=c.trim();new AjaxReq({url:this.attr("data-url"),method:"post",data:b,onSuccess:function(d){if(d&&d.msg){$testRemind(this,d.msg,true)}}.bind(this)}).send()}}})}};$accountExist.verify=true;$verifyRefer.funTestNickname=function(a){return $verifyRefer.funTestName(a,true,"昵称")&&function(){var c=a.attr("data-min")||0,b=a.attr("data-max")||20,e=a.val().trim(),d=false;if(!/^([\u4e00-\u9fa5]|\w)+$/.test(e)){$testRemind(a,"昵称只能包含字母、数字、中文、下划线",true);a.select()}else{if(e.length>b||e.length<c){$testRemind(a,c+"-"+b+"个字符",true);a.select()}else{d=true}}return d}()};var $registVerify=function(){var j=$("regSubmitForm"),g=$("regSubmitBtn"),l=$("regEmail"),i=$("regName"),k=$("regTel"),o=$("regPwd"),p=$("regCity"),b=$("regServerAgree"),a=$("authCode"),e=$("regTelBox"),m=$("pwdCode"),h=$("pwdImgCode"),f=$("pwdCodeChg"),c=$("regAuthCode");var n=$$("label[for='regServerAgree']")[0],d;$focusRemind($$(".focusRemind"));if(j&&g&&l&&i&&k&&o&&b){$testRemind.bind();if(h&&f){h.addEvent("click",function(){this.attr("src",this.attr("src")+Math.random());return false});f.addEvent("click",function(){h.fireEvent("click");return false})}$accountExist([l,i,k]);l.addEvent("blur",function(){var q=this.val().trim(),r=/@/ig;if(r.test(q)){e.removeClass("dn");d=true}else{e.addClass("dn");d=false;k.val("")}});j.addEvent("submit",function(){$accountExist.verify=false;if($verifyRefer.funTestEmailTel(l,true)&&$verifyRefer.funTestNickname(i)&&$verifyRefer.funTestPwd(o,true)&&$verifyRefer.funTestTel(k,d)&&$verifyRefer.funTestCode(m)){if(b.attr("checked")){$formSubmit(g,{text:"注册中...",callback:function(q){if(q.succ==true){h.attr("src",h.attr("src")+Math.random())}}})}else{$testRemind(n,"协议不同意无法完成注册",true)}}return false});if(n){b.addEvent("click",function(){if(this.attr("checked")){n.removeClass("co")}else{n.addClass("co")}}).fireEvent("click")}$$("input[type='email']").addEvent("blur",function(){this.val(DBC2SBC(this.val()))});g.addEvents({mouseenter:function(){$accountExist.verify=false},mouseleave:function(){$accountExist.verify=true}});$firstInputFocus(j)}};var $bindVerify=function(){$testRemind.bind();var d=$("regBindName"),b=$("regBindEmail"),a=$("regBindPwd"),c=$("regBindBtn");if(d&&b&&a&&c){c.addEvents({click:function(){if($verifyRefer.funTestNickname(d)&&$verifyRefer.funTestEmail(b,true)&&$verifyRefer.funTestPwd(a,true)){$formSubmit(this,{text:"账号创建中..."})}return false},mouseenter:function(){$accountExist.verify=false},mouseleave:function(){$accountExist.verify=true}});$enterEvent(a,c);$enterEvent(b,c);$accountExist([d,b])}};var $loginVerify=function(){$testRemind.bind();var c=$("loginMailTel"),f=$("loginPwd"),b=$("loginBtn"),g=$("loginForm"),a=$("resLoginBindRem"),e=$("getLoginCode");$focusRemind($$(".focusRemind"));if(c&&f&&b&&g){f.addEvent("focus",function(){if(a){a.removeClass("g9")}});b.store("value",b.val());if(e){var d=true;e.addEvent("click",function(){if($verifyRefer.funTestTel(c,true)){var l=this.attr("data-url"),k=c.val();if(d){d=false;var j=60,h=setInterval(function(){e.html(j+"秒后重新获取");j--;if(j<0){clearInterval(h);d=true;e.html("获取验证码")}},1000);new AjaxReq({url:l,data:"codetel="+k,method:"post",onSuccess:function(i){if(i.succ){$jsonHandle(i,{})}else{Mbox.alert(i.msg)}},onError:function(){Mbox.alert("抱歉，网络异常，您可以稍后重试。");return false}}).send()}}})}g.addEvent("submit",function(){if($verifyRefer.funTestEmailTel(c,true)&&$verifyRefer.funTestPwd(f,true)){b.attr("disabled","disabled").val("登录中...");new AjaxReq({url:this.attr("action"),data:this.toQueryString(),method:"post",onSuccess:function(h){if(h.succ){$jsonHandle(h,{})}else{Mbox.alert(h.msg,null,{onClose:function(){f.val("").focus()}})}b.attr("disabled","").val(b.retrieve("value"));return false},onError:function(){b.attr("disabled","").val(b.retrieve("value"));Mbox.alert("抱歉，网络异常，您可以稍后重试。");return false}}).send()}return false});if(window.localStorage&&localStorage.getItem("account")&&$isEmpty(c)){c.val(localStorage.getItem("account"))}$firstInputFocus(g)}};var $passwordVerify=function(){var d=$("pwdForm"),f=$("pwdMailTel"),a=$("pwdCode"),c=$("pwdBtn"),b=$("pwdImgCode"),e=$("pwdCodeChg");if(d&&f&&a&&c){$testRemind.bind();d.addEvent("submit",function(){if($verifyRefer.funTestEmailTel(f,true)&&$verifyRefer.funTestCode(a)){$formSubmit(c,{text:"处理中..."})}return false});if(b&&e){b.addEvent("click",function(){this.attr("src",this.attr("src")+Math.random());return false});e.addEvent("click",function(){b.fireEvent("click");return false})}if(window.localStorage&&localStorage.getItem("account")&&$isEmpty(f)){f.attr("data-remind","友情提示，您上一次成功登录的账号是："+localStorage.getItem("account"));$focusRemind(f)}$firstInputFocus(d)}};var URLHOST="http://s1.xiaomishu.com";var IMAGEPIXEL=URLHOST+"/b/img/pixel.gif";var $powerSelect=function(a,c){var b=(a.get("tag")==="input")?"val":"txt";$$(".float_list_a").each(function(d){var e=d.txt().trim();if(e===a[b]().trim()){d.addClass("float_list_a_on")}d.addEvent("click",function(i){var h=new Event(i).target,f=h.txt();a[b](f);$powerFloat.hide();if($isFun(c)){c.call(h,f)}var g=h.attr("href").replace(window.location.href.split("#")[0],"");if(/^#/.test(g)){i.stop();return false}})})};var $powerList=function(b,d,a){if(!$isEle(b)||!$isArr(d)){return false}var e={initvalue:"",callback:$empty};var c=$extend(e,a||{});var f=c.initvalue||b.attr("placeholder")||"";$powerFloat(b,{width:"inherit",eventType:"focus",targetMode:"list",target:d,showCall:function(){if(this.val().trim()===f){this.value=""}this.removeClass("g9");$powerSelect(b,c.callback)}})};var $selectDown=function(a,c,d){if(!$isEle(a)){return}var b="custom_select_focus";$powerFloat(a.addEvent("mouseup",function(){if(this.hasClass(b)){setTimeout(function(){$powerFloat.hide()},15)}}),{width:"inherit",eventType:"click",targetMode:"list",target:c,showCall:function(){this.addClass(b);var e=this.getElement(".custom_select_word");$powerSelect(e,d)},hideCall:function(){this.removeClass(b)}})};var $customTip=function(a){$powerFloat(a,{offsets:{x:0,y:5},showDelay:100,hoverHold:false,targetMode:"tip",targetAttr:"data-tip"})};$$(".googleTrack").addEvent("click",function(){var a=this.attr("data-track");if(a&&window.pageTracker){pageTracker._trackPageview(a)}});var $mboxUpHead=function(a){a.addEvent("click",function(){Mbox.open({title:"上传头像",type:"ajax",ajax:true,ajaxAttr:"data-url",onShow:function(){var d=$("headUpFile"),e=$("headUpVisIpt"),c=$("headUpVisBtn"),b=$("headUpAgainBtn");if(d&&e&&c&&b){e.val("").attr("disabled","");d.addEvent("change",function(){e.val(this.val()).attr("disabled","disabled");c.txt("上传");b.into()});c.addEvent("click",function(){this.getParent("form").submit();return false})}}},this);return false})};var $googleDirect=function(d,g,f,c){c=c||0;var a=function(j){j=j.replace(/[^a-zA-Z0-9\u4E00-\u9FA5]/g,"");var h=["零","一","二","三","四","五","六","七","八","九","十","十一","十二"];var i=/(\d{1,})(?:号线)/ig;return j.replace(i,h[("$1").toInt()])};if($isStr(d)&&$isStr(g)&&$isStr(f)){if(!g){alert("请输入出发地点。");return}else{if(!f){alert("请输入终点。");return}}g=a(g);f=a(f);if(c==1){var b="http://ditu.google.cn/maps?dirflg=r&daddr="+f.cnEncode()+"&saddr="+g.cnEncode();window.open(b)}else{if(c==3){GoogleMap.startGeoCoderService(g,f)}else{var e="http://ditu.google.cn/maps?f=d&source=s_d&saddr="+g.cnEncode()+"&daddr="+f.cnEncode();window.open(e)}}Mbox.close()}};var $commentReport=function(a){if($isEle(a)){a=[a]}if($isArr(a)){a.addEvent("click",function(){var c=this.attr("data-title"),b=this.attr("data-url");Mbox.open({url:b,ajax:true,type:"ajax",title:c,reposition:false});return false})}};var $doComment=function(b){var f={idArea:"cmtReplayArea",idBtn:"cmtReplayBtn",idRem:"cmtReplayRem",urlPost:"/shop/postajax/opComment.aspx",needLogin:true,text:"发表中...",action:"replyAdd",callback:$empty};var d=$extend(f,b||{});var e=$(d.idArea),c=$(d.idBtn),g=$(d.idRem);var a=function(h){h=h||"";if(g){g.txt(h).addClass("co")}};if(e&&c){$autoRemind(e);c.addEvent("click",function(){var j=e.val().trim(),h=this.attr("data-id")||"";if($isEmpty(e)){a("您尚未输入发表的内容");e.focus()}else{a();var i=d.urlPost||this.attr("data-url")||this.attr("rel")||this.attr("href");if(d.needLogin){if(!LOGIN.isLogin||!LOGIN.json.u){LOGIN.mboxcall=function(){c.fireEvent("click")};LOGIN.mboxLogin();return false}}new AjaxPost(this,{url:i,text:d.text,data:{content:j.cnEncode(),userId:(d.needLogin?LOGIN.json.u.id:0),commentId:h,action:d.action},callback:function(k){e.val("");if($isFun(d.callback)){d.callback(k)}}}).send()}return false});e.addEvent("keyup",function(){a()})}};var $replyComment=function(b,a){var c=$extend({action:"resCommReply"},a||{});$testRemind.bind();new Elements(b).each(function(f){var i=f.attr("data-id"),e=$("commReplyContainer_"+i),g=$("commReplyListBox_"+i),j=$("commReplySendBox_"+i),k=$("commReplyNum_"+i),d,h,l;if(j){$visibleToggle(f,{attribute:"data-rel",property:"display",display:j.isDisplayed()});eleReplyBtn=j.getElement(".commReplySendBtn");h=j.getElement(".commReplySendCancel");l=j.getElement(".commReplySendArea");if(h){h.addEvent("click",function(){f.fireEvent("click")})}if(eleReplyBtn&&l){$autoRemind(l)}eleReplyBtn.addEvent("click",function(){var p=l.val().trim(),o=l.attr("data-max"),m=l.attr("data-min"),n={};if($isEmpty(l)){$testRemind(l,"您尚未输入发表的内容",true);l.focus()}else{if(p.length<m||p.length>o){$testRemind(l,"回复的内容须大于"+m+"个字，小于"+o+"字",true);l.focus()}else{n.commentId=i;n[l.name]=p;new AjaxPost(this,{url:this.attr("data-url"),data:n,text:"回复中...",callback:function(z){l.val("");var r=k.html().replace(/\d+/,function(A){return A.toInt()+1});$$("."+k.attr("id")).html(r);var w=z.data||{},t="",v,x;var u=w.username||"游客",s=w.time||"刚刚",y=w.content||"已被加密",q=w.userlink||"";classCo=w.username==="订餐小秘书"?"co":"",headimg=w.headimg||"http://passport.xiaomishu.com/face.aspx?uid=50000944&size=small";t='<li class="pb5 fix"><a '+(q?'href="'+q+'"':"")+'class="l mr10"><img src="'+headimg+'" class="vb" width="48" height="48" /></a><div class="cell"><div class="fix mb10"><span class="l '+classCo+'">'+(q?'<a href="'+q+'" class="g3 b">'+u+'</a><span class="g9 ml5">回复：</span>':"<strong>"+u+"回复：</strong>")+'</span><span class="g9 r">'+s+'</span></div><p class="mb10 cell_bk'+classCo+'">'+y+"</p></div></li>";if(!e.isDisplayed()){e.show();if(x=e.getNext(".bbeb")){x.show()}}if(v=g.getLast()){v.addClass("dot mb10")}g.appendHTML(t)}}).send()}}return false})}})};var $onRadius=function(){["ron","gon"].each(function(a){$$("a."+a).each(function(c){var b=c.txt();if(!navigator.geolocation&&c.retrieve("radiusEd")!==true){c.css("padding","1px 0").html('<span class="'+a+'_ie">'+b+"</span>").store("radiusEd",true)}})})};(function(){var j=new Hash({res:{offsetx:-26,button:$("searchBtn1"),box:$("searchBox1"),element:$("searchInputRes"),cookie:"fg114SearchKey",initvalue:"搜索  餐厅名、路名、商圈名等",posturl:"/shop/dialog/suggest/t1/"},menu:{offsetx:-26,button:$("searchBtn2"),box:$("searchBox2"),element:$("searchInputMenu"),cookie:"fg114DishKey",initvalue:"搜索  菜名等",posturl:"/shop/dialog/suggest/t2/"},home:{width:250,button:$("searchHomeBtn"),box:$("searchHomeBox"),element:$("searchHomeInput"),cookie:"fg114SearchKey",initvalue:"搜索商户名、地址等",posturl:"/shop/dialog/suggest/t1/"}});var c=$$(".jsSearchIntab");var k=function(o){if(o.element){var n=Cookie.read(o.cookie);new Autocompleter(o.element,o.posturl,{width:o.width||o.element.getParent().w(),adjust:{x:(o.offsetx||0),y:0},listCloseBtn:false,delay:50,parser:function(p){var q=[],r=o.element.val().trim();if($type(p.data)==="array"){p.data.each(function(t,s){var u=t.name+"|"+t.id+"|"+(t.result||"");q.push(u)})}p.data=q;return p},onSelection:function(p,q,r,s){if(r){Mbox.remind('正在转向<strong class="ml10">'+s+"</strong>...");$pageFresh(r.replace("&amp;","&"))}},onFocus:function(){var p=function(){o.element.select()}.delay(20)}});var m=function(){var p=false;$$(".ac_select").each(function(q){if(q.getParent().css("visibility")==="visible"){p=true}});return p};o.element.val(n||"").attr("placeholder",o.initvalue).addEvents({keypress:function(p){if(p.key==="enter"&&!m()){o.button.fireEvent("click");p.stop()}}});$autoRemind(o.element)}};var i=function(){var m=$$(".intab_on")[0];if(m&&!m.retrieve("disBind")){if(/Menu/.test(m.attr("rel"))){k(j.menu)}else{k(j.res)}m.store("disBind",true)}};j.each(function(n,m){if(n.button){n.button.addEvent("click",function(){if($isEmpty(n.element)){n.element.focus()}else{var o=n.element.val().replace("+"," ").trimSearch();Mbox.remind("正在搜索<strong class='ml10'>"+o+"</strong>，请稍等...");$pageFresh(n.element.attr("data-url")+o.cnEncode())}return false})}if(m==="home"&&n.box){k(n)}});i();if(c.length){$tabSwitch(c,{classAdd:"intab_on",classRemove:"intab_off",switchCall:function(){i()}})}else{k(j.res)}var d=$("ctripLoginInf"),l="";if(d){window.funCtripLoginCall=function(m){if($isObj(m)&&m.UID){d.store("ctrip",m);var n=m.UserName||m.UID;l='欢迎您，<span class="cui_toolkit_login_name" title="'+n+'">'+n+'</span><a href="http://www.ctrip.com/member/logout.asp">[退出]</a>'}else{if(window.urlCtripLogin){$pageFresh(urlCtripLogin)}l='<a href="'+d.attr("data-loginurl")+location.href+'">登录</a> <a href="http://cards.ctrip.com">合作卡</a> <a href="http://www.ctrip.com/member/signup.asp">注册</a>'}d.html(l)},urlCtrip=d.attr("data-url");if(urlCtrip){new Element("script",{type:"text/javascript",src:urlCtrip,charset:"GB2312"}).inject($$("head")[0])}}var e=$("headChangeCity");if(e){$powerFloat(e,{eventType:"click"})}var h=$("nCitySelect"),g="";if(h){g=h.className+"_on";$powerFloat(h,{eventType:"click",targetAttr:"data-rel",showCall:function(m){var n=null;if(!this.isHasShowed&&(n=m.getElement("textarea"))){m.html(n.val());this.isHasShowed=true}this.setStyle("zIndex",m.getStyle("zIndex")*1+1).addClass(g).getElements(".font").html("&#xfe3f;")},hideCall:function(){this.removeClass(g).getElements(".font").html("&#xfe40;")}})}var b=function(){var m=$("rightBar");if(m){m.load(m.attr("data-url"))}};setTimeout(function(){b()},1000);var f=$("forAppendApp"),a=f&&f.attr("data-src");if(a){f.html('<iframe width="63" height="24" frameborder="0" allowtransparency="true" marginwidth="0" marginheight="0" scrolling="no" border="0" src="'+a+'"></iframe')}})();var $imageShadow=function(e,b){if(e&&$isEle(e)&&((!!window.ActiveXObject&&!e.style.boxShadow)||b)){var d="http://s1.95171.cn/b/img/",c=e.w()*0.8;var a=new Element("img",{src:d+"95_img_sh_b.png","class":"abs",styles:{bottom:-12,left:0,width:c<100?"80%":c,height:12}}),f=new Element("img",{src:d+"95_img_sh_r.png","class":"abs",styles:{right:-9,top:0}});e.adopt([a,f])}},$imageRotate=function(b,a){["Moz","O","Ms","Webkit",""].each(function(c){b.style[c+"Transform"]="rotate("+(90*a)+"deg)"});b.style.filter="progid:DXImageTransform.Microsoft.BasicImage(rotation="+a+")"};var $wedOnlineTalk=function(c){return;var b="http://chat.xiaomishu.com/public/js/chat.js",d;var a=function(){var e=LOGIN.isLogin;d=new Chat({group:"editor",userIsLogin:e?true:false,userId:e?LOGIN.jsonUserInf.u.id:"",userName:e?LOGIN.jsonUserInf.u.nickname:""}).getUrl()};$loadScript(b);c.addEvent("click",function(){var e=this.attr("data-track");if(e&&window.pageTracker){pageTracker._trackPageview(e)}a();if(d){window.open(d)}})};var $homeScript=function(){var m=$("resTopAdImage"),g=$("resTopAdIndex"),i=window.resHomeAdJson,j;var r="",l="";if(m&&g&&(j=($isArr(i)&&i.length))){i.each(function(t,s){r=r+'<a target="_blank"href="'+t.href+'" id="resTopAdImg'+s+'" class="res_home_ad_a '+(s&&"abs_out")+"\" onclick=\"_gaq.push(['_setCustomVar', 2, 'InsiteCampaign', '"+t.href+"', 2]);\""+(s?' data-url="'+t.src+'"></a>':' style="background:url('+t.src+');"></a>');if(j>1){l=l+'<a href="javascript:" class="'+(s?"res_home_ad_off":"res_home_ad_on")+'" rel="resTopAdImg'+s+'">'+(s+1)+"</a>"}});m.html(r);g.html(l);if(j>1){$tabSwitch(g.getElements("a"),{eventType:"hover",classAdd:"res_home_ad_on",classRemove:"res_home_ad_off",timePlay:4000,switchCall:function(t){var s=t.attr("data-url");if(s){t.css("background","url("+s+")").attr("data-url","")}}})}}["","2"].each(function(s){$tabSwitch($$("#resHomeTabBox"+s+" li"),{eventType:"hover",classAdd:"res_home_tab_on",switchCall:function(){window.fireEvent("scroll")}})});$$(".renHomeTabUl li").addEvent("mouseover",function(){if(!this.hasClass("abe_in")){this.getParent().getChildren("li").removeClass("abs_in");this.addClass("abs_in");window.fireEvent("scroll")}});var f=$("resHomeActive"),o=$("resHomeActUp"),k=$("resHomeActDown"),p=f&&f.getElements("li"),n=p&&p.length,d=0;if(f){$smoothSlide(f,p,{direct:"top",name:"any",autoTime:4000,prev:o,next:k})}$$("#resHomeTopBox li").addEvents({mouseenter:function(){this.getElements(".u25").swapClass("u25","u24")},mouseleave:function(){this.getElements(".u24").swapClass("u24","u25")}});$tabSwitch($$("a[name=resHomeBotAdBtn]"),{eventType:"hover",classAdd:"res_home_bot_ad_on",classRemove:"res_home_bot_ad_off"});$wedOnlineTalk($$(".onlineTalk"));var c=$("homeAdSlideBox");if(c){$smoothSlide(c,c.getElements("li"),{direct:"left",name:"res_home_phone",prev:$("homeAdSlidePrev"),next:$("homeAdSlideNext")})}var a=window.resHomeTopAd,j;var b=$("resTopSlide");var q=function(){var s=$("homeTopBox"),t=[];if(s){$smoothSlide(s,s.getElements("li"),{direct:"left",visible:1,name:"res_top",prev:$("homeTopSlidePrev"),next:$("homeTopSlideNext"),nextCall:function(u,v){if(t.indexOf(v)===-1){var w=u.getElements("li")[v].getElements(".adImageLazy");w.each(function(x){x.src=x.attr("data-url")});t.push(v)}}})}};var e=function(){var w=b.w(),v=b.retrieve("width");if(v&&Math.abs(w-v)<10){return}var s=$("homeTopSlidePrev"),t=s&&s.getParent();var u='<ul id="homeTopBox" class="abs_slide"><li class="res_top_slide_li" style="width:'+w+'px;">';a.each(function(y,x){u=u+'<div class="float_three ovh"><span class="res_top_slide_span"><a href="'+y.href+'" target="_blank" class="res_home_top_img">'+(x<3?'<img src="'+y.src+'" /></a>':'<img src="'+IMAGEPIXEL+'" class="adImageLazy" data-url="'+y.src+'" /></a>')+'<a href="'+y.href+'" target="_blank" class="db mt5 f14 g3 b">'+y.title+'</a><strong class="f14 co">'+y.dicount+"</strong></span></div>";if(x%3===2){if(x!==a.length-1){u+='</li><li class="res_top_slide_li" style="width:'+w+'px;">'}}});b.html(u).store("width",w);if(t){t.html(t.html())}q()};var h;if(b&&a){window.addEvent("resize",e);h=setTimeout(e,100)}if($chk(window.screenX)&&window.oResHomeBox){oResHomeBox=$(oResHomeBox);window.addEvent("resize",function(){var s="res_home_min";if(window.getSize().x<1280){oResHomeBox.addClass(s)}else{oResHomeBox.removeClass(s)}})}};var $timeCountDown=function(b){b.each(function(c){c.store("leftSecond",c.attr("data-second")||0)});var a=function(){b.each(function(i){var g=i.retrieve("leftSecond").toInt();if($isNum(g)&&g>0){var e=Math.floor(g/86400),d=Math.floor(g%86400/3600),j=Math.floor(g%3600/60),f=g%60,h="",c="&nbsp;";if(e>3){h="3天以上"}else{if(e){h=h+e+" 天 "}if(e||d){h=h+((d<10)?(c+d):d)+c+"时"+c}if(e||d||j){h=h+((j<10)?(c+j):j)+c+"分"+c}if(!e){h=h+((f<10)?(c+f):f)+c+"秒"}}if(!e&&!d&&!j&&!f){$pageFresh();return}i.html(h).store("leftSecond",--g)}})};a.periodical(1000)};var $backToTop=function(a){if($isArr(a)){a=a[0]}if(!a){return}a.addEvent("click",function(){var b=document.getScroll().y,c=b/6;var d=function(){b-=c;if(b<=0){b=0}window.scrollTo(0,b);if(b>0){setTimeout(d,20)}};d()});funBack=function(){var b=document.getScroll().y,d=window.getSize(),c;c=d.x-a.getCoordinates().right;(b>0)?a.show():a.hide();a.css({right:c});if($isIe6){a.css("top",b+d.y-a.h())}};window.addEvents({scroll:funBack,resize:funBack,domready:function(){funBack();if(window.screen.width<1300){$$("#resFloatBox").css("right",0)}}})};var $selectCity=function(c,j){var b={provinceName:"province",cityName:"city",areaName:"area",provinceUrl:"",cityUrl:"",areaUrl:"",provinceCall:$empty,cityCall:$empty,areaCall:$empty};var a=$extend(b,j||{});if($isArr(c)){var f=c[0],i=c[1],e=c[2];var g=function(m,k){var l='<option value="">请选择</option>';if(m){if($isArr(k)&&k.length){k.each(function(n){l=l+'<option value="'+n.value+'">'+n.text+"</option>"});m.html(l).getElement("option").attr("selected","selected")}else{m.html(l)}}};if(f){var h=a.provinceUrl||f.attr("data-url");if(h){f.addEvent("change",function(){var l={},k=this.val();if(k){l[a.provinceName]=k;new AjaxReq({url:h,data:l,onSuccess:function(m){if(i){g(i,m);i.fireEvent("change")}a.provinceCall.call(this)}.bind(this)}).send()}else{g(i,[]);g(e,[]);a.provinceCall.call(this)}})}}if(i){var d=a.cityUrl||i.attr("data-url");if(d){i.addEvent("change",function(){var l={},k=this.val();if(k){l[a.cityName]=k;new AjaxReq({url:d,data:l,onSuccess:function(m){if(e){if(!m||!m.length){e.out()}else{e.into()}g(e,m);e.fireEvent("change")}a.cityCall.call(this)}.bind(this)}).send()}else{g(e,[]);a.cityCall.call(this)}})}}if(e){e.addEvent("change",function(){a.areaCall.call(this)})}}};var dataStorage={is:window.localStorage,set:function(a,b,c){c=c.toInt();if(this.is){b=c?b+"$TIMEOUT"+(c*86400000+$time()):b;localStorage.setItem(a,b)}else{c?Cookie.write(a,b,{duration:c}):Cookie.write(a,b)}},get:function(b){if(this.is){var a=localStorage.getItem(b),c=a&&a.split("$TIMEOUT"),d;if(c&&(c.length=2)){a=c[0];d=c[1];if(d<$time()){this.remove(b);a=this.get(b)}}return a}else{return Cookie.read(b)}},remove:function(a){if(this.is){localStorage.removeItem(a)}else{Cookie.dispose(a)}}};var $autoSlide=function(){var e=$("resTopAdImage"),a=$("resTopAdIndex"),d=window.resHomeAdJson,c;var b="",f="";if(e&&a&&(c=($isArr(d)&&d.length))){d.each(function(h,g){b=b+'<a target="_blank"href="'+h.href+'" id="resTopAdImg'+g+'" class="res_active_ad_a '+(g&&"abs_out")+'" '+(g?' data-url="'+h.src+'"></a>':' style="background:url('+h.src+');"></a>');if(c>1){f=f+'<a href="javascript:" class="'+(g?"res_home_ad_off":"res_home_ad_on")+'" rel="resTopAdImg'+g+'">'+(g+1)+"</a>"}});e.html(b);a.html(f);if(c>1){$tabSwitch(a.getElements("a"),{eventType:"hover",classAdd:"res_home_ad_on",classRemove:"res_home_ad_off",timePlay:4000,switchCall:function(h){var g=h.attr("data-url");if(g){h.css("background","url("+g+")").attr("data-url","")}}})}}};window.addEvent("domready",function(){var k=$("headSchForm"),o=$("headSchIptRes");var f=function(x){new Autocompleter(x,x.attr("data-url"),{width:x.w(),listCloseBtn:false,delay:50,adjust:{x:-2,y:2},parser:function(y){var z=[],A=x.val().trim();if($type(y.data)==="array"){y.data.each(function(C,B){var D=C.name+"|"+C.id+"|"+(C.result||"");z.push(D)})}y.data=z;return y},onSelection:function(y,z,A,B){if(A){Mbox.remind('正在转向<strong class="ml10">'+B+"</strong>...");k.submit()}},onFocus:function(){(function(){x.select()}).delay(20)}})};var m=$("headSchType"),r=$$("#headSchType a"),b=$("headSchTypeIpt");if(m&&b){var l=m.className+"_hover";r.addEvent("click",function(){var y=this.getParent("dt"),x=this.attr("data-url");y&&y.inject(m,"top");m.removeClass(l);b.val(this.attr("data-val")||"");x&&k&&k.attr("action",this.attr("data-url"));return false});$classToggle(m,{addClass:l})}if(k&&o&&b){var d,t=$("headSchSubmit");t.addEvent("click",function(){d=o.val();if(d=="外卖"){window.open("http://www.xiaomishu.com/app/download/?k=wm","_blank")}else{if(d=="团购"){window.open("http://www.xiaomishu.com/shop/search-pr2/","_blank")}else{if(d=="团购美食"){window.open("http://www.xiaomishu.com/shop/search-pr2/","_blank")}else{if(d=="优惠"){window.open("http://www.xiaomishu.com/shop/search-pr1/","_blank")}else{if(d=="年夜饭"){window.open("http://www.xiaomishu.com/shop/subject/detail_4096_1169/","_blank")}else{k.submit()}}}}}return false});f(o);var g;if(b.val()==0){g=Cookie.read("fg114SearchKey")}else{g=Cookie.read("FG114MallSearchKey")}g&&o.val(g);$autoRemind(o,{label:true})}$commentReport($$(".jsForReport"));$backToTop($$("#backToTop"));var s=$("moreCityAreaBtn"),w,h,p;if(s&&(p=s.getElement(".font"))){w=s.attr("data-switch"),h=p.html();$visibleToggle(s,{attribute:"data-rel",property:"visibility",showCall:function(){p.html(w)},hideCall:function(){p.html(h)}})}var n,v,i=$("hmFlistOut"),u=$("hmFlistIn"),e=$$("#hmFloatFix"),a=false;var j=function(y){var F=y||$$(".hmListHover"),H;var B=new Hash({}),G=(i&&i.attr("data-version"))||"1.7",A=window.localStorage&&localStorage.getItem("versionFhtml");if(F.length&&i&&u){var C=function(I){$$("."+H).removeClass(H);i.hide();a=false},D=function(K){x=K.addClass(H);var L=K.getCoordinates();i.show().css({top:L.top,left:L.right});e.css({height:L.height-4,left:-2});var I=K.attr("data-url"),J="";if(B[I]){u.html(B[I])}else{if(A===G&&(J=localStorage.getItem(I))){u.html(J)}else{u.html('<div style="padding:180px 0;" class="tc hmFListRem">加载中...</div>');new Request.HTML({url:I.query("version",G),link:"cancel",onComplete:function(N,M,O){if(O){B[I]=O;if(window.localStorage){localStorage.setItem("versionFhtml",G);localStorage.setItem(I,O)}u.html(B[I]);z();E()}},onFailure:function(){var M=u.getElement(".hmFListRem");M&&M.html('由于网络原因，加载没有成功，您可以<a href="javascript:" id="hmFListFailTry">点击这里</a>重试。');$$("#hmFListFailTry").addEvent("click",function(){D(K);return false})}}).get()}}z();E();a=true},z=function(){i.css({height:u.h()});var I=x&&x.attr("data-track");if(I&&window._gaq){_gaq.push(["_trackEvent",I,"onmouseover","index"])}},E=function(){var I=i.getElements(".hmFloatMore");if(I.length){var J=I[0].html(),K=I[0].attr("data-text");$visibleToggle(I,{attribute:"data-rel",showCall:function(){this.html(K);z()},hideCall:function(){this.html(J);z()}})}},x;F.addEvents({mouseenter:function(){H=this.attr("data-class");clearTimeout(v);clearTimeout(n);n=setTimeout(function(){(x||$$("."+H)).removeClass(H);D(this)}.bind(this),200)},mouseleave:function(){n&&clearTimeout(n);if(a===true){v=setTimeout(function(){C(this)}.bind(this),190)}}});i.addEvents({mouseenter:function(){v&&clearTimeout(v)},mouseleave:function(){n&&clearTimeout(n);v=setTimeout(function(){C()},100)}})}};var q=$("resTopClass"),c=$("nNavBox");if(q&&c){c.set("load",{onSuccess:function(){i.css("left",q.getCoordinates().right);j(c.store("hasLoaded",true).getElements(".hmListHover"))}});if(q.attr("data-sel")=="true"){q.addEvents({mouseenter:function(){c.w(this.w()).show();if(!c.retrieve("hasLoaded")){c.html('<div style="height:238px;" class="loading bgf5"></div>').load(c.attr("data-url"))}},mouseleave:function(){c.hide()}})}else{i.css("left",q.getCoordinates().right)}}});var $cornerFun=function(){var h=$("cornerS"),d=$("cornerL"),a=$("cornerClose");if(!d||!h||!a){return}var g="ShowRightTopAdv",f=new Fx.Morph(d,{duration:"short",transition:Fx.Transitions.Sine.easeOut}),c,e=function(){var j=0;if(window.getSize().x<=1300){j=55}$$("#rightNavDiv").addClass("trans").css("padding-right",j)};var i=true;h.addEvents({mouseenter:function(){if(i){c=(function(){h.hide();d.show();f.start({height:200,width:200});a.show();e();Cookie.write(g,1)}).delay(200)}},mouseleave:function(){i=true;$clear(c)}});a.addEvent("click",function(){i=false;f.start({height:55,width:55});(function(){h.show();d.hide()}).delay(200);a.hide();e();Cookie.write(g,0);return false});if(Cookie.read(g)==0){h.show();d.hide();a.hide()}else{h.hide();d.show();a.show()}e.periodical(2000);var b=function(){h.show();d.hide();a.hide()};b.delay(30000)};$cornerFun.delay(2000);var $leftFloatBox=function(a){if(window.screen.width<=1280){a.css("right","0")}window.addEvent("scroll",function(){var c=document.getScroll().y,b=window.getSize();if($("backToTop")){(c>0)?$("backToTop").visible():$("backToTop").invisible()}if($isIe6){a.css("position","absolute");a.css("top",c+b.y-a.h()-100+"px")}if(window.screen.width<=1280){a.css("right","0")}if($$(".constr_sp").length>0){a.css("margin-left","-140px")}})};$leftFloatBox($$(".resFloatBox"));$backToTop($("backToTop"));var eleNavHover=$$(".navHotHover"),eleNavIn=$$(".navHotIn");eleNavHover.addEvents({mouseenter:function(){var a=this.getNext("li").getElements(".navHotIn");a.store("tmpTitle",a.txt());a.txt(a.attr("data-title"));a.attr("data-title",a.retrieve("tmpTitle"))},mouseleave:function(){var a=this.getNext("li").getElements(".navHotIn");a.store("tmpTitle",a.txt());a.txt(a.attr("data-title"));a.attr("data-title",a.retrieve("tmpTitle"))}});eleNavIn.addEvents({mouseenter:function(){this.getParent("li").getPrevious(".navHotHover").fireEvent("mouseenter")},mouseleave:function(){this.getParent("li").getPrevious(".navHotHover").fireEvent("mouseleave")}});