var RESURL={gmap:URLHOST+"/b/js/gmap.js?v=3",bmap:URLHOST+"/b/js/min/bmap.js",nopic:"http://s1.95171.cn/b/img/95_no_pic_s.png",ajaxComment:"/shop/postajax/opComment.aspx",choFood:"/shop/postajax/Dish_DoOrder.aspx",choList:"/shop/postajax/GetDishList.aspx",choError:"/shop/postajax/error.aspx",ajaxImp:"/shop/postajax/updateImpression.ashx",diaImp:"/shop/dialog/addImpression.aspx",succCall:"/shop/dialog/Sharing.aspx",parkIconCenter:"/b/img/res_park_center.png",parkIconNormal:"/b/img/res_park_normal.png",parkIconHover:"/b/img/res_park_hover.png"};(function(){var h=$("headResFavBtn"),F=$("headFavIcon"),q="收藏",t="已"+q;if(h){var z=function(){h.html(t).swapClass("g3","g9 def tdn").attr("title",t);if(F){F.addClass("u21")}};h.set("load",{onComplete:function(I,H,K,J){if(K===t){z()}}});h.load(h.attr("data-rel")+"&action=load");h.addEvent("click",function(){if(this.txt()==q){new AjaxPost(h,{url:(h.attr("data-rel")||h.attr("rel"))+"&action=favres",text:q+"中...",callback:function(H){z()}}).send()}return false})}var u=$("headSendMsgMobile");if(u){u.addEvent("click",function(){var H=this.attr("data-rel")||this.attr("rel");if(H){Mbox.open({ajax:true,type:"ajax",url:H+$time(),title:"发送短信"})}})}var a=$("resDescMore");if(a){$visibleToggle(a,{showCall:function(){this.txt("<< 收起简介")},hideCall:function(){this.txt("展开简介>>")}})}var j=$("resTipsMore");if(j){$visibleToggle(j,{showCall:function(){this.txt("<<收起")},hideCall:function(){this.txt("展开>>")}})}var p=$("headResPhoto");if(p){$lazyLoading(p);if(p.attr("data-type")){var c=p.getParent().w(),G,d="left",C=1;var k=function(){var H=p.css("margin-left").toInt()||0;if(d==="left"){if(H<=c-G){d="right"}else{H-=C}}else{if(H>=0){d="left"}else{H+=C}}p.css("margin-left",H);setTimeout(k,30)},e=function(){var H=new Element("span",{styles:{position:"absolute",background:"#000",opacity:0.5,padding:"2px 5px",color:"#fff"}}).txt("360度环视图").injectBefore(p)};var b=new Image();b.onload=function(){G=b.width;k();e()};b.src=p.attr("data-url")}else{p.w("100%")}}var D=$("headOrderDate"),f=$("headOrderHour"),o=$("headOrderMini"),w=$("headOrderNums"),g=$("fastBookBtn");if(D&&f&&o&&w&&g){var s=$time()-86400000,r=$time()+86400000*28;new Datepicker(D,D,{initValue:D.attr("placeholder"),splitChar:false,column:true,range:[new Date(s),new Date(r)]});var v=[{text:"10点"},{text:"11点"},{text:"12点"},{text:"13点"},{text:"14点"},{text:"15点"},{text:"16点"},{text:"17点"},{text:"18点"},{text:"19点"},{text:"20点"},{text:"21点"}];$powerList(f,v);var E=[{text:"00分"},{text:"15分"},{text:"30分"},{text:"45分"}];$powerList(o,E);$autoRemind(w);var l={testDate:function(H){var I=H.val(),J=I.match(/\d+/g);if(!J||!J.length){return"--年--月--日"}if(J[1].length===1){J[1]="0"+J[1]}if(J[2].length===1){J[2]="0"+J[2]}return J.join("-")},testTime:function(J,H){var I=DBC2SBC(J.val().trim()).toInt()||"0";if(H<2&&I<10){return"0"+I}else{return I}}};g.addEvent("click",function(){var K=l.testDate(D),H=l.testTime(f,0),L=l.testTime(o,1),M=l.testTime(w,2);var I=K+" "+H+":"+L+":00";var J=this.attr("data-url")||"/shop/"+this.attr("data-resid")+"/book/";$pageFresh(J+"?odate="+I.cnEncode()+"&pcount="+M);return false});$enterEvent(w,g)}var B=$("resGtab"),A=$("resGtabLine");if(B&&A){$smartFloat(B,{fixedCall:function(){this.addClass("gtab_float").w(A.w())},normalCall:function(){this.removeClass("gtab_float").w("auto")}})}var i=$("bookFloatRemShut"),n=$("bookFloatRemind"),m=window.localStorage;if(i&&n&&window.dataStorage){i.addEvent("click",function(){n.hide();dataStorage.set("shuted_1","true",14)});if(!dataStorage.get("shuted_1")){n.into()}}})();var resDefaultInit=function(){$$("#searchBus").addEvent("click",function(){Mbox.open({ajax:true,title:"公交/驾车查询",type:"ajax"},this);return false});var f=$("promBookEmail"),c=$("promRssBtn");if(c&&f){$testRemind.bind();$autoRemind(f);c.addEvent("click",function(){var g=f.val().trim();if($verifyRefer.funTestEmail(f,true)){var i=this.attr("data-login"),h=this.attr("href");if(i){new AjaxPost(this,{url:h,data:{email:g},callback:function(){$testRemind.hide()}}).send()}}return false});$enterEvent(f,c)}if(d){d=d}else{var d=1}var e=$("mboxGoogleMap");if(e){e.addEvent("click",function(){var h=this.attr("data-rel")||this.attr("rel"),g=Number(this.attr("data-x")),i=Number(this.attr("data-y"));if(h){Mbox.open({title:"餐厅地图",url:h,type:"ajax",ajax:true,onShow:function(){if(d==1){$loadScript(RESURL.bmap,function(){var k=$("updateMapLocation"),l=$("resMapDetail"),j=$("resMapCity");if(l&&j){BMAP.htmlWindow=l.html();BMAP.show(g?[i,g]:j.html())}if(k){BMAP.markurl=k.attr("data-url");BMAP.markdata={resid:k.attr("data-resid")};k.addEvent("click",function(){if(LOGIN.isLogin){BMAP.mark()}else{LOGIN.mboxLogin()}return false})}});return}else{$loadScript(RESURL.gmap,function(){var l=$("updateMapLocation"),m=$("resMapDetail"),k=$("resMapCity");if(m&&k){var j=[g,i];if(!g){j=k.html()}GoogleMap.mapMsg=[j,[m.html()]];GoogleMap.showLocation(GoogleMap.mapMsg[0]);GoogleMap.ShowMapInfo(g,i)}if(l){GMAPPARAMS.markurl=l.attr("data-url");GMAPPARAMS.markdata={resid:l.attr("data-resid")};l.addEvent("click",function(){if(LOGIN.isLogin){GoogleMap.customMarkPoint()}else{LOGIN.mboxLogin()}return false})}})}}})}return false})}var b=function(s,o,v){if(!q){var q=16}if(d==1){var j=new BMap.Map(v);var p=new BMap.Point(o,s);var u=q+1;j.centerAndZoom(p,u);var w=new BMap.Icon(RESURL.parkIconCenter,new BMap.Size(26,34));j.addOverlay(new BMap.Marker(p,{icon:w}));function h(B,A){var z=Math.sin(B.lat*Math.PI/180)*Math.sin(A.lat*Math.PI/180);var i=Math.cos(B.lat*Math.PI/180)*Math.cos(A.lat*Math.PI/180)*Math.cos((A.lng-B.lng)*Math.PI/180);return 6371000*Math.acos(z+i)}function r(i,A){var B=new BMap.Icon(RESURL.parkIconNormal,new BMap.Size(26,34));var z=new BMap.Marker(i,{icon:B});z.value=A;z.addEventListener("click",function(){var C=parseInt(h(p,i));var E="<strong style='color:red; font-size:14px;'>"+arrMsg[A-1].title+"</strong><p style='margin-top:10px; font-size:12px;'>地址："+arrMsg[A-1].address+"</p><p style='margin-top:10px; font-size:12px;'>距离：<strong style='color:#f30'>"+C+"</strong> 米</p>";var F={width:250,height:100};var D=new BMap.InfoWindow(E,F);j.openInfoWindow(D,i)});z.addEventListener("mouseover",function(E){var D=new BMap.Icon(RESURL.parkIconHover,new BMap.Size(26,34));z.setIcon(D);var C=h(p,i)/1600;m(p.lat,p.lng,C)});z.addEventListener("mouseout",function(){g.remove();var C=new BMap.Icon(RESURL.parkIconNormal,new BMap.Size(26,34));z.setIcon(C)});return z}var g;function m(I,J,H){var E=Math.PI/180;var z=180/Math.PI;var B=(H/3963)*z;var C=B/Math.cos(I*E);var D=[];for(var F=0;F<33;F++){var A=Math.PI*(F/16);Cy=I+(B*Math.sin(A));Cx=J+(C*Math.cos(A));var G=new BMap.Point(Cx,Cy);D.push(G)}g=new BMap.Polygon(D,{strokeColor:"#6E8820",strokeWeight:2,strokeOpacity:0.5,fillColor:"#6E8820",fillOpacity:0.2});j.addOverlay(g)}if(arrMsg){for(var l=0;l<arrMsg.length;l++){var t=new BMap.Point(arrMsg[l].y,arrMsg[l].x);j.addOverlay(r(t,l+1))}}}else{var j=new GMap2(document.getElementById(v));var p=new GLatLng(s,o);var u=q;j.setCenter(p,u);j.setUIToDefault();var n=new GIcon(G_DEFAULT_ICON);var k=new GIcon(n);k.image=RESURL.parkIconCenter;markerOptions={icon:k};k.iconSize=new GSize(26,34);j.addOverlay(new GMarker(p,markerOptions));function h(B,A){var z=Math.sin(B.lat()*Math.PI/180)*Math.sin(A.lat()*Math.PI/180);var i=Math.cos(B.lat()*Math.PI/180)*Math.cos(A.lat()*Math.PI/180)*Math.cos((A.lng()-B.lng())*Math.PI/180);return 6371000*Math.acos(z+i)}function r(i,A){k.image=RESURL.parkIconNormal;var z=new GMarker(i,markerOptions);z.value=A;GEvent.addListener(z,"click",function(){var B=parseInt(h(p,i));var C="<strong style='color:red; font-size:14px;'>"+arrMsg[A-1].title+"</strong><p style='margin-top:10px; font-size:12px;'>地址："+arrMsg[A-1].address+"</p><p style='font-size:12px;'>距离：<strong style='color:#f30'>"+B+"</strong> 米</p>";j.openInfoWindowHtml(i,C)});GEvent.addListener(z,"mouseover",function(C){z.cl.src=RESURL.parkIconHover;var B=h(p,i)/1600;m(p.lat(),p.lng(),B)});GEvent.addListener(z,"mouseout",function(){g.remove();z.cl.src=RESURL.parkIconNormal});return z}var g;function m(I,J,H){var E=Math.PI/180;var z=180/Math.PI;var B=(H/3963)*z;var C=B/Math.cos(I*E);var D=[];for(var F=0;F<33;F++){var A=Math.PI*(F/16);Cy=I+(B*Math.sin(A));Cx=J+(C*Math.cos(A));var G=new GPoint(Cx,Cy);D.push(G)}g=new GPolygon(D,"#6E8820",1,0.5,"#6E8820",0.2);j.addOverlay(g)}if(arrMsg){for(var l=0;l<arrMsg.length;l++){var t=new GLatLng(arrMsg[l].x,arrMsg[l].y);j.addOverlay(r(t,l+1))}}}};var a=$("mboxParking");if(a){a.addEvent("click",function(){var h=this.attr("data-rel")||this.attr("rel"),g=Number(this.attr("data-x")),i=Number(this.attr("data-y"));if(h){Mbox.open({title:"餐厅附近停车信息",url:h,type:"ajax",ajax:true,onShow:function(){b(g,i,"map-cnt")}})}return false})}};var $shareIcon=function(b,c){var a=null;b.addEvent("click",function(){var e=this,g=e.attr("data-url"),d=[],f="";if(g){if(f=e.attr("data-dated")){$testRemind(e,f,true);$$("#shareRebind").addEvent("click",function(){window.open(g);a=e;$testRemind.hide()})}else{window.open(g);a=this}}else{d=this.attr("data-u").split("|");this.swapClass(d[Number(this.hasClass(d[1]))],d[Number(this.hasClass(d[0]))]);if($isFun(c)){c.call(this)}}});window.addEvent("focus",function(){if(a){new AjaxPost(a,{url:a.attr("data-ajax"),callback:function(){a.attr("data-url","").fireEvent("click");a=null}}).send()}})};var $sendComment=function(){var v=$("cmtEditBox"),q=$("cmtSendLink"),j=$("cmtSendRemind"),t=$("cmtStarScore"),c=$("cmtSelTaste"),k=$("cmtSelEnvir"),f=$("cmtSelServe"),A=$("cmtFoodInput"),r=$("cmtResId"),d=$("cmtUserId"),z=$("anonymous"),p=$("secretEater");var e=null,b=q&&(q.attr("data-url")||RESURL.ajaxComment);var u=$("cmtRadioChk")?true:false;if(!t||!j||!c||!k||!f){return}if(v){v.addEvents({focus:function(){if(this.txt().trim()===this.attr("placeholder")){if(Browser.Engine.trident){this.html("")}else{this.html("<br />")}}this.css("color","#333")}});v.onpaste=function(){var D=$(this),E="";setTimeout(function(){if(Browser.Engine.trident){E=D.html().replace(/<p>/gi,"♂").replace(/<\/p>/gi,"♀").stripHTML().replace(/♂/g,"<p>").replace(/♀/g,"</p>")}else{E=D.html().replace(/<br(?:.|\s)*?>/gi,"♂").stripHTML().replace(/♂/g,"<br>")}D.html(E);D.blur();D.focus()},5)}}var h=$$("input[name='myExpeRec']");if(h.length===1){h[0].attr("checked","checked")}var i=function(){var D="";h.each(function(E){if(E.attr("checked")){D=E.val();return}});return D};if(!r||!d){return}if(A){$$("#cmtLoveFood a").addEvent("click",function(){var F=this.txt(),E=A.val().trim(),D=[F];if(E){D=E.split(" ").include(F)}A.val(D.join(" "));return false})}var n=function(){var E=A&&A.val().trim().split(" "),D=true;if(E&&E.length){E.each(function(F){if(D&&F.length>50){D=false}})}return D};var w=new Hash({}),a=$("cmtUpPicLink"),o=$("cmtUpPicBox");var C=function(D,E){};var l=function(E,D){var F=this;w[D.fileid]=D.filename+","+D.filesrc+","+D.filepath+","+D.filesize+","+D.fileid+(D.md5?","+D.md5:"")+",0";$$(".uppicImgRename").each(function(G){G.addEvent("click",function(){var J=this.attr("data-id"),H=$("uppicListName_"+J),I=H&&H.getElement("input");if(I){H.addClass("abs_in");I.focus();I.select()}return false}).removeClass("uppicImgRename")});$$(".uppicNameInput").each(function(G){G.addEvents({blur:function(){var L=this.attr("data-id"),I=this.val().trim(),K=$("uppicListName_"+L),H=K&&K.getElement("span");if(H){H.html(I);K.removeClass("abs_in");var J=w[L].split(",");J[0]=I;w[L]=J.join()}},keydown:function(H){if(H&&H.key==="enter"){this.fireEvent("blur");H.stop()}}}).removeClass("uppicNameInput")});$$(".uppicImgDelete").each(function(G){G.addEvent("click",function(){var J=this.attr("data-id"),I=$("uppicListBox_"+J),H=I&&I.getParent();if(H){H.set("tween",{onComplete:function(){H.dispose();w.erase(J);F.pms.the_files.erase(F.file_stamp(E));F.files_data.erase(J);F.pms.g_hasuploadcount--;if(F.pms.g_hasuploadcount<0){F.pms.g_hasuploadcount=0}var L=$("resUppicAppendBox"),K=null;if(o.getElements(".uppicListImg").length===0){o.getParent().addClass("vh")}if(L&&(K=L.retrieve("initHtml"))&&L.getElements(".uppicListImg").length===0){L.html(K)}}}).fade("out")}return false}).removeClass("uppicImgDelete")});$$(".uppicImgRotate").each(function(G){G.addEvent("click",function(){var H=this.retrieve("rotate"),K=this.attr("data-id"),J=$("uppicImage_"+K);if(J){H++;if(H>3){H=0}$imageRotate(J,H);this.store("rotate",H);var I=w[K].split(",");I[I.length-1]=H*90;w[K]=I.join()}return false}).store("rotate",0).removeClass("uppicImgRotate")});if(this.files_data.getLength()===0){$$("#resUppicClose").show()}};var g=function(){$$("#resUppicClose").hide()};var s=$$("#shareToOther u");if(a&&o){a.addEvent("click",function(){Mbox.open({url:this.attr("data-url"),type:"ajax",ajax:true,title:"上传图片",closable:false,onShow:function(){$loadScript(URLHOST+"/b/js/min/swfupload.js?v=4",function(){$resUppicSwf.params.html_temp_ready=$$("#upReadyHTML").val().join();$resUppicSwf.params.html_ready_event=g;$resUppicSwf.params.html_temp_finish=$$("#upBackHTML").val().join();$resUppicSwf.params.html_temp_event=l;$resUppicSwf.params.g_hasuploadcount=0;$resUppicSwf.init()},"swfupload");var D=$("resUppicAppendBox");if(D){D.store("initHtml",D.html())}$$("#resUppicSubmit, #resUppicClose").addEvent("click",function(){var E;if(D&&D.getElements(".uppicListImg").length>0){var F=D.getChildren();F.attr("id","");o.adopt(F).getParent().removeClass("vh")}else{if((E=$$(".resUppicNoX"))&&E.length){E.fireEvent("click")}}Mbox.close()})}});return false})}var B={},m=function(){var D=[];s.each(function(E){if(E.hasClass(E.attr("data-u").split("|")[1])){D.push(E.attr("data-value"))}});return D};if(b){q.addEvent("click",function(){var H=i(),F=c.val(),E=k.val(),G=f.val();if(u&&!H){j.txt("您好，您尚未选择相应的订单记录");if(h[0]){h[0].focus()}}else{if(!e){j.txt("您好，您尚未给出总体印象评分")}else{if(!F.toInt()){j.txt("您好，顺便给口味评个分吧");c.focus()}else{if(!E.toInt()){j.txt("您好，顺便给环境评个分吧");k.focus()}else{if(!G.toInt()){j.txt("您好，顺便给服务评个分吧");f.focus()}else{if(!n()){j.txt("单个菜品名不能超过50个字");A.focus();A.select()}else{var I=v.html().trim();var D=v.txt().trim();if(!I.trimHTML()||D===v.attr("placeholder")){j.txt("您好，发送空点评是不是有些不太好？");v.focus()}else{if(I.replace(/\s+/g," ").length>2000){j.txt("长度不能超过2000个字");v.focus()}else{if(!$chk(window.screenX)){I=I.stripHTML()}else{I=I.replace(/<br>/gi,"\r\n").replace(/<([a-zA-Z])+>/g,"\r\n").stripHTML().replace(/^\\r\\n/,"")}B={action:"CommentAdd",orderForm:H,scoreTotal:e.attr("rel"),scoreTaste:F,scoreEnvir:E,scoreServe:G,textSend:I,loveFood:A&&A.val().trim(),picData:(function(){var J=[];o.getElements(".uppicListImg").each(function(K){var L=K.id.split("_")[1];if(L){J.push(w[L])}});return J.join(";")})(),shareData:m().join(),resId:r.val(),userId:d.val()};if(z){B.anonymous=z.attr("checked")?1:0}if(p){B.secretId=p.attr("checked")?p.attr("value"):0}new AjaxPost(q,{url:b,text:"发表中，请稍等...",data:B,callback:function(J){Mbox.open({url:RESURL.diaImp,type:"ajax",ajax:true,title:"发表成功",ajaxOptions:{data:{resId:r.val(),commentId:J.id||"",isEat:J.isEat,action:"comment",shareData:m().join()}},onClose:function(){$pageFresh(J.returnUrl)}})}}).send()}}}}}}}}setTimeout(function(){j.txt("")},5000)})}t.addEvents({mouseenter:function(){if(e){e.removeClass("star_hover_"+e.attr("rel")+"_on")}},mouseleave:function(){if(e){e.addClass("star_hover_"+e.attr("rel")+"_on")}}});t.getElements("a").addEvent("click",function(){e=this;return false});$shareIcon(s,function(){})};$sendComment.extend({reply:function(a){$doComment(a)},send:function(a){$doComment(a)}});var $funFoodSearch=function(){var c=$("choFoodSchInput"),b=$("choFoodSchBtn");var a=function(){var e=c.val().trim().cnEncode(),d=b.attr("href");$pageFresh(d+e+"#menu")};if(c&&b){c.addEvent("keydown",function(d){if(d.key==="enter"){d.stop();a()}});b.addEvent("click",function(){a();return false})}};var resFoodChoose=function(){var a={jsonStore:new Hash(),jsonList:{},jsonCho:{},eleFloatBox:$("choFloatBox"),eleFloatBody:$("choFloatBody"),eleFloatTitle:$("choFloatTitle"),eleListBox:$("foodListOut"),eleChoMain:$("choFloatMain"),eleChoBot:$("choFloatBot"),eleChoCash:$("choFloatCash"),eleResId:$("choResId"),eleOrderId:$("choOrderId"),htmlBtn:function(b,d){var c=' data-id="'+d+'"';if(!b){return'<a href="javascript:" class="res_cho_btn vh" name="resChoOpt" title="点菜" '+c+' data-num="1">点菜</a>&nbsp;'}else{return'<span class="res_cho_nums"><a href="javascript:" class="res_cho_desc" name="resChoOpt" title="减少一份" data-num="'+(b-1)+'" '+c+'></a><input class="res_cho_input" name="resChoInput" value="'+b+'" '+c+' title="修改选菜数量" data-type="list" /><a href="javascript:" class="res_cho_asc" name="resChoOpt" title="增加一份" data-num="'+(b+1)+'" '+c+"></a></span>"}},htmlList:function(){var d=this.jsonList,c="",i=d.sortUrl||"javascript:",b='<a href="'+i+'" class="g3 mr5 choListSort" title="点击按价格升序排列" data-sort="A1">价格(元)</a>',h='<a href="'+(d.sortHotUrl||"javascript:")+'" class="g3 choListSort" title="按人气排序" data-sort="D2">人气</a>',e="A1",g="点击按价格升序排列",f=true;if(d.sortStyle==="D1"){b=b+'<span class="char_corb g3">◆</span>'}else{if(d.sortStyle==="A1"){b='<a href="'+i+'" class="g3 mr5 choListSort" title="点击按价格降序排列" data-sort="D1">价格(元)</a><span class="char_cort g3">◆</span>'}else{if(d.sortStyle==="D2"){h='人气<span class="char_corb ml5">◆</span>'}}}c+='<ul class="fix res_cho_list_title"><li class="l pct33">菜名</li><li class="l pct20 tc">'+b+'</li><li class="l pct15 tc g3">'+h+'</li><li class="l pct25 tc">数量/操作</li></ul>';if($isArr(d.arrId)){d.arrId.each(function(n){var k,l=d.items[n];if(l.price==-1){k="时价"}else{if(l.price==-2){k="不详"}else{k=l.price+l.units}}var j=l.num?l.num.toInt():0,m=l.src||RESURL.nopic;c+='<ul class="fix res_cho_list '+(j?"res_cho_list_on":"")+'" '+(j?"":'data-hover="true"')+' data-id="'+n+'"><li class="l pct33"><a href="'+l.href+'" target="_blank" class="g3 res_cho_tit_a db">'+l.title+(/nopic/.test(l.src)?"":'<u class="u u20"></u>')+'</a><a target="_blank" href="'+l.href+'"><img width="110" class="res_cho_img dn" src="'+m+'" /></a><p class="g9 res_cho_descr dn">'+(l.desc||"暂无描述")+'</p></li><li class="l pct20 tc g6">'+k+'</li><li class="l pct15 tc g6">'+(l.clicknum||"--")+'</li><li class="l pct25 tc">'+this.htmlBtn(j,n)+'</li><li class="l"><a href="javascript:" class="g9 abs vh foodErrorBtn" data-id="'+n+'">报错</a></li></ul>';f=false}.bind(this))}if(d.pageSize&&d.pageSize<d.totalNum){c+='<ul class="res_cho_list"><li><span class="char_corr mr5">◆</span><a href="'+d.moreUrl+'" class="g6 tdl">查看此条目下全部<strong class="co"> '+d.totalNum+"</strong> 道菜</a></li></ul>"}if(f){return""}return c},htmlCho:function(){var c=this.jsonChoNew,b="",d=true;this.textFood=[];$$("a[name='resChoLink']").each(function(e){var f=e.getElement("span");if(f){f.txt("")}});new Hash(c).each(function(f,h){b+='<div class="fix '+(d?"":"btd")+'">';var g=f.length,e=f[0].tag;b+='<div class="res_cho_fl_key l" style="padding-top:'+((g-1)/2*26+8)+'px;"><div class="pl10 fix"><span class="float_two">'+e+'</span><span class="float_two tc">× '+g+'</span></div></div><div class="cell bld">';if($(h)){$(h).txt("× "+g)}if($("t0")){$("t0").txt("× "+this.numSpecial)}this.textFood.push(g+"道"+e);f.each(function(j){var k=(j.title.length>6)?(j.title.slice(0,6)+"..."):j.title,i;if(j.price==-1){i="时价"}else{if(j.price==-2){i="不详"}else{i=j.price+j.units}}b+='<ul class="res_cho_fl_list fix" '+((g===1)?'style="border-bottom:0;margin-bottom:0;"':"")+'><li class="l w100" title="'+j.title+'">'+k+'</li><li class="l pct25 tc">'+i+'</li><li class="l"><input class="res_cho_input" name="resChoInput" value="'+j.num+'" title="修改选菜数量" " data-type="float" data-id="'+j.id+'" /></li><li class="r"><a href="javascript:" class="aclose" name="resChoOpt" title="删除该选菜" data-num="0" data-id="'+j.id+'">×</a></li></ul>'});b+="</div></div>";d=false}.bind(this));return b},htmlChoBot:function(){var b='<p class="g9 mb5">餐厅菜单仅供参考，实际以餐厅公布的价格为准。</p><h6>金额统计<span class="ml10">'+this.numPrice+'</span></h6><p class="mt5">统计：'+(this.textFood.length?this.textFood.join("、"):"无选菜")+"</p>";return b},visChoCash:function(){return this},appendHtml:function(){var b=this.htmlList();if(b){this.eleListBox.html(b)}this.eleChoMain.html(this.htmlCho());this.eleChoBot.html(this.htmlChoBot());this.visChoCash().eventBind();return this},numChange:function(b,e,c){this.jsonCho.food.each(function(f){if(f.id==e){f.num=c}});var d=this.jsonChoGroup().htmlCho();if(b.attr("data-type")==="float"){if(this.jsonList.items[e]){this.jsonList.items[e].num=c;this.eleListBox.html(this.htmlList())}}else{this.eleChoMain.html(d)}this.eleChoBot.html(this.htmlChoBot());return this},eventBind:function(){var b=this;var f="res_cho_list_hover",e=this.eleListBox.getElements("ul[data-hover=true]");$classToggle(e,{addClass:f});$$("a[name='resChoOpt']").addEvent("click",function(){var h=this.attr("data-id"),g=this.attr("data-num");if(h&&g&&!this.retrieve("unclick")){b.ajaxChoose(h,g);b.currentBtn=this}return false});var d=function(h){var g=c(this);if(g){if(h.key==="enter"){b.ajaxChoose(g.id,g.num,true)}else{b.numChange(this,g.id,g.num)}}},c=function(g){var i=g.attr("data-id"),h=DBC2SBC(g.val()).toInt();if(!$chk(h)){$testRemind(g,"请输入数值",true);return false}else{if(h>100){$testRemind(g,"数值需小于100",true);return false}else{return{id:i,num:h}}}};$$("input[name='resChoInput']").each(function(g){new Observer(g,d.bind(g),{delay:200});g.addEvents({focus:function(){this.select();$testRemind.hide()},change:function(){var h=c(this);if(!this.retrieve("unclick")&&h){b.ajaxChoose(h.id,h.num);b.currentBtn=this}}})});$$(".choListSort").addEvent("click",function(j){var i=this.jsonList.currentId,h=j.target.attr("data-sort"),g=j.target.attr("href");if(/javascript/.test(g)){this.jsonList.sortStyle=h;this.getListHtml(h,i);return false}}.bind(this));$$(".foodErrorBtn").addEvent("click",function(){Mbox.open({url:RESURL.choError+this.attr("data-id"),ajax:true,type:"ajax"})});return this},menuEventBind:function(){var b="res_cho_link_on",c="res_cho_link";$$("a[name='resChoLink']").each(function(d){if(d.hasClass(b)){this.eleMenuOn=d}d.addEvent("click",function(){var e=d.attr("href");if(!d.hasClass(b)&&/javascript/.test(e)){var g=d.attr("data-id"),f=this.jsonList.sortStyle;this.jsonList.currentId=g;this.getListHtml(f,g);this.eleMenuOn.swapClass(b,c);d.swapClass(c,b);this.eleMenuOn=d;return false}}.bind(this))}.bind(this));$funFoodSearch();return this},floatEventBind:function(){var k=this.eleFloatTitle,c=this.eleFloatBody,i=this.eleFloatBox,j=$("choCashRefBtn"),l=$("resSaleCashChg");var d=function(n){if(j){var m=j.attr("href");if(/&count/.test(m)){m=m.split("&count")[0]+"&count="+n}else{m=m+"&count="+n}j.attr("href",m)}};k.addEvent("click",function(){if(c.retrieve("display")){k.removeClass("res_cho_fl_open");c.out().store("display",false)}else{k.addClass("res_cho_fl_open");c.into().store("display",true)}}.bind(this));if(l){$testRemind.bind();$$("#resSaleCashAsc").addEvent("click",function(){var m=Number(l.val());if(m!==m.toInt()){l.fireEvent("blur")}else{l.val(m+1);l.fireEvent("blur")}return false});$$("#resSaleCashDesc").addEvent("click",function(){var m=Number(l.val());if(m!==m.toInt()){l.fireEvent("blur")}else{l.val(m-1);l.fireEvent("blur")}return false});var g;l.addEvents({focus:function(){this.select()},blur:function(){var n=this.val(),m=this.attr("data-max").toInt();if(Number(n)!==n.toInt()){$testRemind(this,"请输入整数值",true);this.select()}else{if(n.toInt()>m.toInt()){$testRemind(this,"最多支持"+m+"张现金券",true);this.val(m);d(m)}else{if(n.toInt()<1){$testRemind(this,"至少1张现金券",true);this.val(1);d(1)}}}},keyup:function(){if(g){clearTimeout(g)}g=setTimeout(function(){l.fireEvent("blur")},500)}})}if($isIe6){var b=function(){var m=i.h(),o=$(window).getHeight(),n=$(window).getScroll().y;i.css({top:n+o-m});setTimeout(b,200)};b()}var h=$("choFoodFavMenu"),e=$("choFoodPrintMenu"),f=$("choFoodSmsMenu");if(h){h.addEvent("click",function(){var m=this.eleResId.val(),n=this.eleOrderId.val();if(LOGIN.isLogin){new AjaxPost(h,{url:"/shop/postajax/dish_dosave.aspx",data:{resid:m,orderId:n,act:"save"},text:"收藏中...",callback:function(){Mbox.alert("收藏成功！您可以去<a href='/member/mydishorder.aspx'>会员中心</a>进行查看。",null,{onClose:function(){$pageFresh()}})}}).send()}else{LOGIN.mboxLogin()}return false}.bind(this))}if(e){e.addEvent("click",function(){var m=this.eleResId.val(),n=this.eleOrderId.val();window.open("/adentity/dish_print.aspx?orderId="+n+"&resId="+m+"&autoPrint=1")}.bind(this))}if(f){f.addEvent("click",function(){window.open("/adentity/dish_sms.aspx?orderId="+this.eleOrderId.val())}.bind(this))}return this},getListHtml:function(b,c){if(this.jsonListCache()){this.jsonStore[b+c].sortStyle=this.jsonList.sortStyle;this.jsonStore[b+c].currentId=this.jsonList.currentId;this.jsonList=this.jsonStore[b+c];this.jsonExtend().appendHtml()}else{this.ajaxList()}return this},jsonChoGroup:function(){this.jsonChoNew={};this.numSpecial=0;this.numPrice=0;if($isArr(this.jsonCho.food)){this.jsonCho.food.each(function(b){if(this.jsonChoNew[b.tagId]){this.jsonChoNew[b.tagId].push(b)}else{this.jsonChoNew[b.tagId]=[b]}if(b.special){this.numSpecial++}this.numPrice+=((b.price.toInt()<0)?0:Number(b.price))*Number(b.num)}.bind(this))}return this},jsonExtend:function(){if($isArr(this.jsonCho.food)){this.jsonCho.food.each(function(c){var b=this.jsonList.items[c.id];if(b){this.jsonList.items[c.id]=$extend(b,c)}}.bind(this))}return this},jsonListCache:function(b,d){var c=this.jsonList.sortStyle+this.jsonList.currentId;if(this.jsonStore[c]){if(d){this.jsonList=this.jsonStore[c]}return true}else{if(b){this.jsonStore[c]=this.jsonList}return false}},ajaxList:function(){var b=this;var c=this.eleResId.val();b.eleListBox.html('<div style="height:400px;" class="loading"></div>');new AjaxReq({url:RESURL.choList,data:{pageSize:b.jsonList.pageSize,typeId:b.jsonList.currentId,typeSort:b.jsonList.sortStyle,resId:c,version:"2"},onSuccess:function(d){b.jsonList=d;b.jsonListCache(true);b.jsonExtend().appendHtml()},onError:function(){b.eleListBox.html('<div style="line-height:400px;" class="tc co">抱歉，数据加载没有成功。</div>')}}).send();return this},ajaxChoose:function(f,c){var b=this;if(c==0&&this.jsonList.items[f]){this.jsonList.items[f].num=0}this.clickDisable(true);var d=this.eleResId.val(),e=this.eleOrderId.val();new AjaxReq({url:RESURL.choFood,data:{foodId:f,num:c,resId:d,orderId:e},method:"post",onSuccess:function(i){b.clickDisable(false);b.jsonCho=i||{};b.eleOrderId.val(b.jsonCho.orderId);b.jsonExtend().jsonChoGroup().appendHtml();var g=function(j){b.eleFloatBox.visible();if(j){if(b.eleFloatBody.css("position")!=="static"){b.eleFloatTitle.fireEvent("click")}if(!i.food.length){b.mainError("您尚未选择任何菜品。")}}};var h=window.location.href;if(!f){if(i.food.length){if(/open=true/.test(h)){g(true)}else{g()}}}else{g(true)}},onError:function(){b.clickDisable(false).mainError("抱歉，数据加载没有成功。")}}).send();return this},mainError:function(b){this.eleChoMain.html('<div style="line-height:100px;" class="tc co">'+b+"</div>");return this},clickDisable:function(b){if(this.currentBtn){this.currentBtn.store("unclick",b)}return this},init:function(){var b=this;if(window.jsonListData){this.jsonList=jsonListData;this.jsonListCache(true);this.currentBtn=null;this.floatEventBind().ajaxChoose().menuEventBind();if(window.arrChoSort){$selectDown($("foodCustomSel"),arrChoSort,function(){var c=this.attr("href").split("#")[1];if(c&&c!=="menu"){b.jsonList.sortStyle=c;b.ajaxList()}})}}return this}};a.init()};var $funResSupport=function(c,b){var d={id:"",cookieName:"",eleRemind:null,numAttr:"rel",action:"UpFood"};var e=$extend(d,b||{});if($isEle(c)&&e.id){var a=function(){if(e.eleRemind){e.eleRemind.into()}};c.addEvent("click",function(){var g=Cookie.read(e.cookieName),h,f=false;if(g){h=g.split("_");h.each(function(i){if(i===e.id){f=true}})}if(f){a()}else{new AjaxPost(c,{url:c.attr("href"),data:{cookieName:e.cookieName,action:"UpFood",foodId:e.id},callback:function(i){var j=$(c.attr(e.numAttr));if(j&&i.num){j.txt("("+i.num+")");a()}}}).send()}return false})}};var $foodSingleChoose=function(a){if($isEle(a)){new AjaxPost(a,{data:{orderId:$("choOrderId").val(),resId:$("choResId").val(),foodId:$("choFoodId").val(),num:a.attr("data-num"),isJump:1}}).href()}};var $speFoodComment=function(){var i=$("speAddCmtBtn"),d=$("speCmtLogin"),a=$("speCmtNoLogin");var b=$("speCmtResName"),h=$("speCmtSendArea"),e=$("speCmtSendBtn"),c=$("speCmtSendRem"),j="",g="/specials/postajax/GetFoodListAjax.aspx";var f=function(){if(!b||!c){return}var l=b.attr("data-topic");$autoRemind(b);var k=function(){new AjaxReq({url:g,data:{fgsearchq:b.val().trim(),topicId:l},onSuccess:function(m){if(m&&$isArr(m.data)&&m.data.length){j=m.data[0].id;b.val(m.data[0].name)}else{c.txt("您输入的餐厅暂不供应此特色菜。")}}}).send()};new Autocompleter("speCmtResName",g,{extraParams:{topicId:l},listCloseBtn:false,delay:300,parser:function(m){var n=[];if($type(m.data)==="array"){m.data.each(function(p,o){var q=p.name+"|"+p.id;n.push(q)})}return n},onBlur:function(){if(!j&&!$isEmpty(b)){k.delay(100)}},onFocus:function(){c.txt("")},onSelection:function(q,t,r,s){if(r){j=r}}});if(e&&h&&c){h.addEvent("focus",function(){c.txt("")});e.addEvent("click",function(){var m=h.val().trim();c.txt("");if(!j){c.txt("您尚未选择相对应的餐厅。")}else{if($isEmpty(h)){c.txt("您尚未输入评论内容。")}else{new AjaxPost(this,{url:"/specials/postajax/opComment.aspx",text:"发表中...",data:{content:m.cnEncode(),foodId:j,action:"DishCommentAdd"},callback:function(){j="";h.val("")}}).send()}}})}}();if(i){LOGIN.mboxcall=function(){$pageFresh()};i.addEvent("click",function(k){if(k){j=""}if(LOGIN.isLogin){if(d&&b){d.into();var l=$$("#resSpeResName_"+j).html().join();if(l){b.val(l);h.focus()}else{b.focus()}}}else{if(a){a.into()}}});$$(".speAddCmtBtn").addEvent("click",function(){j=this.attr("data-id");if(LOGIN.isLogin){i.fireEvent("click")}else{LOGIN.mboxLogin()}return false})}};var $sinaShareMbox=function(a){if(a){Mbox.open({url:RESURL.succCall,type:"ajax",ajax:true,title:a.title||"友情提示",ajaxOptions:{data:a.param||{}}})}};var $quickImpress=function(a){a.addEvent("click",function(d){var c=this.getElement(".res_impress_in");var f=c?c.txt().trim():this.txt().trim(),g=this.attr("data-id"),b=$("jsLoadImpress_"+g);if(g){new AjaxPost(this,{url:RESURL.ajaxImp,data:{impress:f,resId:g},callback:function(e){if(e){if(b&&e.loadUrl){b.load(e.loadUrl)}$sinaShareMbox(e)}}}).send()}d.stop();return false})};var $floatMoreImpress=function(a){$powerFloat(a,{eventType:"click",targetMode:"ajax",targetAttr:"href",position:"8-6",showCall:function(d){var b=$isEle(d)&&d.getElements(".tipTrigger");var c=$$(".jsSendImpress");$powerFloat(b,{offsets:{x:0,y:5},showDelay:100,zIndex:25,hoverHold:false,targetMode:"tip",targetAttr:"data-tip"});$quickImpress(b);$quickSendImpress(c);this.attr("href",this.href.replace("&rank","&rank1"))}})};$quickSendImpress=function(a){a.each(function(b){var d=b.attr("data-id"),c=$("sendImpInput_"+d);if(c){c.addEvents({focus:function(){this.css("width","96%");b.removeClass("vh")},lose:function(){this.css("width","120px");b.addClass("vh")}});document.addEvent("mousedown",function(g){var f=g.target;if(f!==c&&!f.getParents(".jsSendImpress").length){c.fireEvent("lose")}});$sendImpress(b,c)}})};$sendImpress=function(a,b,c){if(a&&b){$autoRemind(b);$testRemind.bind();a.addEvent("click",function(){var i=this.attr("data-id"),f=this.attr("data-url"),d=b.val().trim().split(" "),h=false,g=0,e=0;if($isEmpty(b)){if(Mbox.isOpen){Mbox.close()}else{$testRemind(b,"您尚未输入或选择标签内容",true);b.focus()}}else{if(d.length>5){$testRemind(b,"最多添加5个标签",true);b.focus();b.select()}else{d.each(function(k){if(!h){var j=k.length;if(j>25){h=true;e=g+j}else{g=g+j+1}}});if(h){$testRemind(b,"单个标签字符个数不超过15",true);b.selectRange(g,e)}else{new AjaxPost(this,{url:this.attr("data-url"),remind:c,data:{resId:this.attr("data-id"),impress:b.val().trim()},callback:function(j){var k=$("jsLoadImpress_"+i);if(j){$sinaShareMbox(j);if(k&&j.loadUrl){k.load(j.loadUrl)}}b.val("").css("color","#999")}}).send()}}}return false});b.addEvent("keyup",function(d){if(d.key==="enter"){a.fireEvent("click")}d.stop()})}};var $schSpecial=function(){var f="char_corr",h="char_cort";$visibleToggle($$(".schAllArea"),{showCall:function(){this.txt("收起");this.getPrevious().swapClass(f,h)},hideCall:function(){this.txt("展开全部");this.getPrevious().swapClass(h,f)}});$powerFloat($$(".fitDetailToggle"),{eventType:"click",targetMode:"ajax",container:$("fitDetailBox")});$$(".schChkLinkA").addEvent("click",function(){$pageFresh(this.attr("href"))});$$(".schResFav").addEvent("click",function(){var k=this,l=this.attr("href");if(l){new AjaxPost(k,{url:l,text:"收藏中...",callback:function(){k.html("已收藏").attr("href","").addClass("disabled tdn");$$("#resFavIcon_"+k.attr("data-resid")).addClass("u21")}}).send()}return false});$customTip($$(".tipTrigger"));$floatMoreImpress($$(".impressMore"));$quickImpress($$(".quickImpress a"));$$(".jsLoadImpress").each(function(k){k.set("load",{method:"post",onSuccess:function(){$customTip(k.getElements(".tipTrigger"));$floatMoreImpress(k.getElements(".impressMore"));$quickImpress(k.getElements(".quickImpress a"));$quickSendImpress(k.getElements(".jsSendImpress"))}})});var e=new Hash({supp:"fitSuppBtn|fitSuppNum",unsupp:"fitUnsuppBtn|fitUnsuppNum"});e.each(function(n,l,o){var m=n.split("|")[0],k=n.split("|")[1];$$("."+m).store("key",l).store("idKey",k).addEvent("click",function(){var s=this.retrieve("key"),p=this.retrieve("idKey"),t=this.attr("data-id"),r=$(p+"_"+t),q=$("fitTotalNum_"+t);if(r&&q){new AjaxPost(this,{url:this.attr("data-url"),data:{resId:t,action:s},callback:function(u){r.txt(r.txt().toInt()+1);q.txt(q.txt().toInt()+1);Mbox.open({url:RESURL.diaImp,type:"ajax",ajax:true,title:(s==="supp")?"赞同":"反对",ajaxOptions:{data:{resId:t,action:"support",agree:u.agree}}})}}).send()}})});var j=$("schSpeServBox"),d,i;if(j&&(d=$("schSpeServSure"))&&(i=$("schSpeServMore"))){var a=(function(){var k=0;i.getElements("dl").each(function(l){k+=l.h()});return k})();$$("#schSpeServToggle").addEvent("click",function(){var k=this.retrieve("display");if(k===false){i.h(a);this.store("display",true).html(this.html().replace(">b<",">t<").replace("更多","精简"))}else{i.h(0);this.store("display",false).html(this.html().replace(">t<",">b<").replace("精简","更多"))}this.blur();return false}).store("display",false);var c=j.getElements("input");var b=d.attr("data-url"),g=function(){var k=0;c.each(function(l){if(l.attr("checked")){k+=l.val().toInt()||0}});if(k&&b){d.attr("href",b.replace("$s$",k))}return k};d.addEvent("click",function(){if(!g()){j.highlight();$testRemind(this,"您尚未选择任何特色服务。",true);return false}});$testRemind.bind();c.addEvent("click",g)}};var $schRelative=function(){var c,b,a="res_sch_rel_con",d=$("schRelContainer");if(d){$$("#schRelListBox li").addEvents({mouseenter:function(){var f=this.getPosition(),e=false;if(c){c.dispose()}if(b){clearTimeout(b)}b=setTimeout(function(){c=new Element("div",{"class":a+" "+(window.screenX?"trans":a+"_hover"),styles:{left:f.x,top:f.y},events:{mouseover:function(){e=true},mouseleave:function(){this.dispose()}}}).html(this.html()).inject(d);setTimeout(function(){if(!e&&c){c.dispose()}},$isIe6?1500:600)}.bind(this),200)},mouseleave:function(){clearTimeout(b)}})}};var $diaImpress=function(){var c=$("diaImpInput"),b=$("diaImpressMore"),a=$("diaImpSendBtn"),e=$("diaImpCancelBtn"),f=$("diaImpRem");$visibleToggle(b,{property:"display",showCall:function(){this.destroy();Mbox.reposition(true)}});$sendImpress(a,c,f);if(e){e.addEvent("click",function(){Mbox.close()})}var d=$$("a[name=diaImpLink]");d.addEvent("click",function(j){var i=this.getElement(".res_impress_in");var k=i?i.txt().trim():this.txt().trim(),h=c.val().trim(),g=[k];if(!$isEmpty(c)){g=h.split(" ").include(k)}c.val(g.join(" "));return false})};var $resSpecialAdd=function(){var i=new Hash({}),k=$$("#speId").val().join(),a=$$("#typeId").val().join();$testRemind.bind();if(k==="0"){Mbox.open({url:"subjectChoBox",title:"选择专题",onShow:function(){var r=$("subjectChoSel1"),p=$("subjectChoSel2"),m=$("subjectChoRem"),o=$("subjectChoBtn"),u=o&&o.attr("data-url");if($isIe6){r.visible();p.visible()}var t=window.jsonChoSubject,s="",q="",n=' selected="selected"';htmlInit2='<option value="0" class="g9"'+n+">请选择二级分类</option>";if(t){t.each(function(w,v){if(w.ref){s=s+'<option value="'+v+'"'+(v===a?n:"")+">"+w.text+"</option>"}});r.html(s).addEvent("change",function(){var A=t[this.val()],z,v="",w;if(A&&$isObj(A.ref)){z=new Hash(A.ref);z.each(function(C,B){v=v+'<option value="'+B+'">'+C+"</option>"})}p.html(htmlInit2+v)}).fireEvent("change")}if(u){o.addEvent("click",function(){var w=r.val(),v=p.val();if(w==="0"){$testRemind(r,"您尚未选择专题",true);r.focus()}else{if(v==="0"){$testRemind(p,"您尚未选择二级分类",true);p.focus()}else{new AjaxPost(this,{url:this.attr("data-url"),text:"提交中...",data:{subject1:w,subject2:v,subjectId:k}}).send()}}})}},onClose:function(){$pageFresh("/shop/search/sp"+a)}});return}var h=$("resSpeListBox"),j=$("resSpeSchInput"),l=$("resSpeSchBtn"),d=$("resSpeStyleArea"),c=$("resSpeSchBox"),f=$("clearSchHtml"),g=$("resSpeSendBtn");if(!l||!l){return}var b=function(){var n="",m=1,o=h.attr("data-remind");i.each(function(p,q){n=n+'<li class="dot pt10 pb15"><div class="fix"><strong class="l">'+m+".&nbsp;"+p+'</strong><a href="javascript:" class="tdl r" name="resSpeListDel" data-id="'+q+'">删除</a></div><div class="mt15 pb2"><strong class="g6 l mr10">推荐理由：</strong><div class="cell"><textarea class="area pct74 resSpeRecoCont" name="reason'+q+'" rows="4" placeholder="请输入10-200字，您写的推荐内容会在网站上展示出来哦..." required>'+$$("textarea[name=reason"+q+"]").val().join()+"</textarea>"+((o&&m===1)?'<p class="mt5 pt2">'+o+"</p>":"")+"</div></div></li>";m++});h.html(n||'<li class="p5 g9 dot lh24">尚未选择餐厅</li>');$$("a[name=resSpeListDel]").addEvent("click",function(){var p=this.attr("data-id");i.erase(p);b();e();return false});$$(".resSpeRecoCont").each(function(p){$autoRemind(p)})},e=function(){$$(".addResToList").each(function(m){var o=m.attr("data-id"),n=$("addFinRem_"+o);if(i[o]){m.hide();n.show()}else{m.show();n.hide()}})};c.set("load",{onSuccess:function(){l.store("unclick",false).txt("搜索");e();$$(".addResToList").addEvent("click",function(){if($$(".resSpeRecoCont").length>=10){Mbox.alert("您好，最多添加10个餐厅进入榜单。");return false}var o=this.attr("data-id"),m=$("resSpeName_"+o),n=$("addFinRem_"+o);if(m&&n){i[o]=m.txt();b();e()}})}});l.addEvent("click",function(){var m=this.attr("data-url"),n=j.val().trimSearch();if(n&&!this.retrieve("unclick")){$testRemind.hide();this.store("unclick",true).txt("搜索中...");c.html('<div style="height:250px;" class="loading"></div>').load(m+"?s="+n.cnEncode()+"&specialId="+k)}else{j.focus();if(j.val()){$testRemind(j,"您输入的内容为不合法字符",true);j.select()}else{$testRemind(j,"您尚未输入搜索的内容",true)}}return false});$enterEvent(j,l);d.addEvent("mousedown",function(){this.blur();return false});f.addEvent("click",function(){c.html("");j.focus();if(j.val()){j.select()}});g.addEvent("click",function(){var n=i.getKeys(),o={},m=true;if(!n.length){Mbox.alert("您尚未选择任何商户",null,{time:2000})}else{$$(".resSpeRecoCont").each(function(q){if(m){var p=q.val().trim();if(!$verifyRefer.funTestName(q,true,"推荐理由")){m=false}else{if(p.length<10||p.length>200){q.focus();$testRemind(q,"推荐理由需要在10-200字之间",true);m=false}else{o[q.attr("name")]=p}}}});if(m){new AjaxPost(this,{url:this.attr("data-url"),data:$extend({specialId:k,resId:n.join(",")},o),text:"发布中...",callback:function(p){$sinaShareMbox(p)}}).send()}}})};var $resUppic={attr:"data-rel",resId:$("resId")&&$("resId").val(),urlCompleter:"/b/tmp/ajax/json_food2.asp",urlDelete:"/b/tmp/ajax/support.asp",hashRadios:new Hash({}),eleUppicDel:$$(".foodUppicDel"),eleUppicSubmit:$("foodUppicSubmit"),funRadioSwitch:function(){var b=new Hash({}),a=this.attr;$$(".upInfRadio").each(function(c){var d=c.attr("name")||"noname";if(b[d]){b[d].push(c)}else{b[d]=[c]}c.removeClass("upInfRadio")});this.hashRadios=b;b.each(function(c){$tabSwitch(new Elements(c),{property:"display",targetAttr:a,classAdd:"forRadioToggle",switchCall:function(){$$(".foodUppicBox").css("visibility","hidden");$$(".foodUppicBox").css("visibility","visible")}})});return this},funCompleter:function(){$$(".autoFoodName").each(function(a){var b=true;new Autocompleter(a,this.urlCompleter,{listCloseBtn:false,delay:200,extraParams:{resId:this.resId,time:"t"+$time()},parser:function(c){arrExp=c;if($type(arrExp)==="array"){arrAuto=[];arrExp.each(function(e,d){var f=e.name+"|"+d+"|"+e.price+e.units;arrAuto.push(f)});return arrAuto}},onSelection:function(c,d,e,f){b=false;this.funFoodInf(arrExp[e],a.attr("data-id"))}.bind(this),onBlur:function(){}});a.removeClass("autoFoodName")}.bind(this));return this},funFoodInf:function(f,g){var b=$("foodPrice_"+g),e=$("foodUnit_"+g),c=$("foodTags_"+g),a=$("foodDesc_"+g),d=$("foodIdHidden_"+g);if(d){d.val(f.id)}if($isObj(f)&&b&&c&&e&&a){if(f.price=="-1"){b.val("时价");e.val("")}else{b.val(f.price);e.val(f.units)}c.val(f.tag);a.val(f.des||"")}return this},funUppicDel:function(){$$(".foodUppicDel").addEvent("click",function(g){var f=".foodUppicBox",b=$$(f),d=g.target,c=d.getParent(f),a="您确认删除该上传的图片？";if(c){if(b.length===1){a="这是最后一张图片，"+a}Mbox.confirm(a,function(){new AjaxPost(d,{url:this.urlDelete,data:{id:d.attr("data-id")},callback:function(e){var h=this.hashRadios;c.set("tween",{duration:200,onComplete:function(){h.erase(c.getElement("input[type='radio']").attr("name"));if(b.length===1){$pageFresh(e.jumpurl||"95_index.asp")}c.dispose();var i=d.retrieve("objFixed");if(i){i.obj.pms.the_files.erase(i.obj.file_stamp(i.file));i.obj.files_data.erase(i.file.id)}}}).tween("opacity",0)}.bind(this)}).send();Mbox.close()}.bind(this),null,{title:"友情提醒"})}return false}.bind(this)).removeClass("foodUppicDel");return this},funUppicRotate:function(){$$(".foodUppicRot").each(function(a){a.addEvent("click",function(){var e=this.attr("data-id"),b=$("upPicImage_"+e),d=$("upPicRotate_"+e);if(b&&d){var c=((parseInt(d.val(),10)||0)+1)%4;$imageRotate(b,c);d.val(c)}return false}).removeClass("foodUppicRot")});return this},funUppicOrder:function(){var a=$$(".upInfCon4");a.each(function(e){var g=e.attr("data-id"),d=$("isEmptyIpt_"+g),f=$("selPurposeIpt_"+g),b=$$(".isEmpty_"+g),c=$$(".selPurpose_"+g);if(d){b.addEvent("click",function(){b.swapClass("res_kind_btn_on","res_kind_btn");this.swapClass("res_kind_btn","res_kind_btn_on");d.val(this.attr("data-value"))})}if(f){c.addEvent("click",function(){c.swapClass("res_kind_btn_on","res_kind_btn");this.swapClass("res_kind_btn","res_kind_btn_on");f.val(this.attr("data-value"))})}})},funUppicSubmit:function(){var c=this.eleUppicSubmit,e=this.resId;if(!c){return}var d=$$("#shareToOther u"),b=$$("#shareHidIpt");$shareIcon(d,function(){b.val((function(){var f=[];d.each(function(h){var g=h.attr("data-url");if(g){if(h.attr("data-dated")){$powerFloat(h,{eventType:"click",targetMode:"remind",target:h.attr("data-dated"),position:"5-7"})}else{h.addEvent("click",function(){window.open(g)})}}else{h.addEvent("click",function(){f.push(h.attr("data-value"))})}});return f.join()})())});var a=Browser.Engine.webkit||(Browser.Engine.trident&&document.querySelector);$$("#shareToOther").css("verticalAlign",a?"2px":"10px");$testRemind.bind();c.addEvent("click",function(){var h=true;this.hashRadios.each(function(j){var i=0;if(h){j.each(function(k){if(k.attr("checked")){i=1}});if(!i){h=false;$testRemind(j[0],"该图片您尚未选择分类",true);j[0].focus()}}});if(h){$testRemind.bind();var f=[],g=false;$$(".forRadioToggle").each(function(i){var j=$(i.attr("data-rel")).getElement(".upFoodInput");if(j){f.push(j)}});f.each(function(j){var i;if(g===false){if((i=$verifyRefer.funTestNumber(j,false,"价格",false))&&Number(j.val())<1000000){g=false}else{if(i){$testRemind(j,"价格不能超过6位数",true);j.select()}g=true}}});if(g===false){$formSubmit(c,{text:"正在努力提交中...",callback:function(){var k=$("upAlertHTML");var j,i;if(k){j=k.val();i=k.attr("data-url")}Mbox.alert(j||"提交成功",null,{onClose:function(){$pageFresh(i||"/shop/"+e+"/pic/")}})}})}}}.bind(this));return this},initFinish:function(){this.funRadioSwitch().funCompleter().funUppicDel().funUppicRotate().funUppicOrder();if(!this.submitBind){this.funUppicSubmit();this.submitBind=true}return this}};var $resUppicSwf=(function(){var newText="";var objFixed={resId:$$("#resId").val().join(),userId:$$("#userId").val().join(),files_data:new Hash(),pms:{the_files:new Hash(),upload_done:true,g_hasfail:false,g_stop_upload:false,g_hasuploadcount:0,filecount:0},operate_remind:function(text){if(text){newText=text+"<br />"+newText;this.eleRemind.show().html(newText);clearTimeout(this.timerRemind);this.timerRemind=setTimeout(function(){newText=""}.bind(this),100)}},file_stamp:function(file){return file.name+"#"+file.size+"#"+file.type+"#"+file.creationdate+"#"+file.modificationdate},file_html:function(){var htmlTempReady=this.pms.html_temp_ready,html="";if(this.pms.upload_done&&htmlTempReady&&this.eleAppendBox){this["files_data"].each(function(value,key){html=html+htmlTempReady.replace(/\$\w+\$/gi,function(matchs){return value[matchs.replace(/\$/g,"")]})});this.eleAppendBox[this.pms.g_hasuploadcount===0?"html":"appendHTML"](html)}return this},file_html_event:function(){$$(".resUppicNoX").addEvent("click",function(e){var eleDel=new Event(e).target,fileid=eleDel.attr("data-rel"),strFile=this["files_data"][fileid],eleFileBox;if(eleFileBox=$(fileid)){if(strFile){this.pms.the_files.erase(this.file_stamp(strFile))}this.files_data.erase(fileid);this.swfup.cancelUpload(fileid);this.pms.upload_done=true;eleFileBox.set("tween",{onComplete:function(){eleFileBox.dispose();if(this.files_data.getLength()===0){this.eleOpt.setStyle("height","auto")}}.bind(this)}).fade("out")}}.bind(this))},fileQueueError:function(file,errorCode,message){switch(errorCode){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:this.operate_remind("您最多一次性上传"+objChangable.defaults.file_queue_limit+"张照片。");break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.operate_remind("您上传的图片"+file.name+"大小不能超过"+Math.floor(parseInt(objChangable.defaults.file_size_limit)/1024)+"M.");break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.operate_remind("您上传了空文件。");break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:this.operate_remind("文件类型不支持。");break;default:this.operate_remind("抱歉，出现未知错误。");break}return this},fileQueued:function(file){var s=this.file_stamp(file);if(this.pms.the_files[s]){this.swfup.cancelUpload(file.id);this.operate_remind(file.name+" 已经上传，请不要重复添加");this.pms.upload_done=false}else{this["files_data"][file.id]=file;this.pms.the_files[s]=true;this.pms.upload_done=true}return this},fileDialogComplete:function(){this.file_html().file_html_event();this.pms.g_stop_upload=false;this.swfup.startUpload();return this},uploadStart:function(file){this.swfup.addPostParam("title",file.name);this.swfup.addPostParam("swfid",file.id);this.swfup.addPostParam("resid",this.resId);this.swfup.addPostParam("userid",this.userId);this.eleOpt.setStyle("height",0);this.operate_remind();this.pms.html_ready_event.call(this,file);return this},uploadError:function(file,errorCode,message){if(errorCode==SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED){var json={status:"7"};this.uploadSuccess(json)}return this},uploadSuccess:function(file,serverData){var json=eval("("+serverData+")");if(!json){return false}if(json.status!=0&&json.status!=7){this.pms.g_hasfail=true}else{this.files_data.erase(file.id)}if(json.status=="0"){this.g_allfail=false;this.pms.g_hasfail=false;this.pms.g_hasuploadcount++}if(this.files_data.getLength()===0){this.eleOpt.setStyle("height","auto").addClass("abs_in")}var key,htmlDeal=this.pms.html_temp_finish;for(key in json){if(!/(status|ordernumber|filesize|swfid)/i.test(key)){htmlDeal=htmlDeal.replace(new RegExp("\\$"+key+"\\$","gi"),json[key])}}$$("#"+file.id).html(htmlDeal);this.pms.html_temp_event.call(this,file,json);return this},uploadProgress:function(file,completedBytes,totalBytes){var el=$(file.id+"_progress");if(!el||totalBytes<=0||completedBytes<=0||completedBytes>totalBytes){return}var progress=Math.round((completedBytes/totalBytes)*100)+"%";el.css("width",progress);return this},uploadComplete:function(file){if(this.swfup.getStats().files_queued>0){if(this.pms.g_stop_upload==false){this.swfup.startUpload()}}return this},params:function(){return{file_queue_error_handler:this.fileQueueError.bind(this),file_queued_handler:this.fileQueued.bind(this),file_dialog_complete_handler:this.fileDialogComplete.bind(this),upload_start_handler:this.uploadStart.bind(this),upload_error_handler:this.uploadError.bind(this),upload_success_handler:this.uploadSuccess.bind(this),upload_progress_handler:this.uploadProgress.bind(this),upload_complete_handler:this.uploadComplete.bind(this),button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,debug:false}}};var objChangable={defaults:{upload_url:"/shop/uploadphoto",file_size_limit:"10240",file_types:"*.jpg;*.jpeg;*.png;*.gif",file_types_description:"照片文件",file_upload_limit:20,file_queue_limit:10,button_placeholder_id:"resUppicSwf",button_image_url:IMAGEPIXEL,button_width:166,button_height:31,flash_url:"/shop/swfupload/swfupload.swf"},params:{html_temp_ready:"",html_ready_event:$empty,html_temp_finish:"",html_temp_event:$empty},init:function(){objFixed.pms=$extend(this.params,objFixed.pms);objFixed.eleAppendBox=$("resUppicAppendBox");objFixed.eleRemind=$$("#resUppicRemind");objFixed.eleOpt=$$("#resUppicOpt");objFixed.swfup=new SWFUpload($extend(this.defaults,objFixed.params()))}};return objChangable})();var $resAddByUser=function(){var p=$("pwdCodeChg"),j=$("pwdImgCode"),c=$("pwdBackCode");if(p&&j&&c){new Elements([p,j]).addEvent("click",function(){j.attr("src",j.attr("src")+Math.random());return false})}if(o){o=o}else{var o=0}var l=$("resAddName"),i=$("resAddBtn"),q=$("resAddFood"),r=$("resOpenTime"),d=$("resTrivalInf"),f=$("resAddCity"),b=$("resAddRegion");$$(".autoRemind").each(function(s){$autoRemind(s,{label:true})});$visibleToggle($$("#resAddTel"),{showCall:function(){this.txt("还是算了")},hideCall:function(s){this.txt("继续添加电话");s.getElement("input").val("").fireEvent("blur")}});var n=$("resAddAddress"),g=$$("#resAddLat"),a=$$("#resAddLng"),m=$("resAddMapMark");new Elements([n,f,b]).addEvent("change",function(){if(m&&m.retrieve("mapPosition")){m.store("mapPosition",null).txt("重新标注")}});var k=function(){Mbox.open({title:"地图标注",ajaxAttr:"data-url",onShow:function(){if(o==1){$loadScript(RESURL.bmap,function(){BMAP.markurl=null;BMAP.markcall=function(u,v){g.val(v);a.val(u);Mbox.close();Mbox.alert("标注成功。",null,{time:2000});m.store("mapPosition",{lat:v,lng:u}).txt("修改标注")};var s=m.retrieve("mapPosition").lat,t=m.retrieve("mapPosition").lng;BMAP.show([t,s]);BMAP.mark()},"bmapMark");return}else{$loadScript(RESURL.gmap,function(){GMAPPARAMS.markurl=null;GMAPPARAMS.markcall=function(v,u){g.val(v);a.val(u);Mbox.close();Mbox.alert("标注成功。",null,{time:2000});m.store("mapPosition",{lat:v,lng:u}).txt("修改标注")};var s=m.retrieve("mapPosition").lat,t=m.retrieve("mapPosition").lng;GoogleMap.mapMsg=[[s,t],[""]];GoogleMap.showLocation(GoogleMap.mapMsg[0]);GoogleMap.customMarkPoint()},"gmapMark")}},onClose:function(){$$("#map-cnt").html("")}},m)};if(m&&n){m.addEvent("click",function(){var s=n&&n.val().trim();if(this.retrieve("mapPosition")){k()}else{new AjaxPost(this,{url:n.attr("data-url")+s+"&"+f.attr("name")+"="+f.val()+"&"+b.attr("name")+"="+b.val(),callback:function(t){x=t.lat||m.attr("data-lat");y=t.lng||m.attr("data-lng");g.val(x);a.val(y);m.store("mapPosition",{lat:x,lng:y});k()}}).send()}return false})}var h=function(v,s){var u=new Hash(v),t='<option value="">请选择'+s+"</option>";u.each(function(z,w){t=t+'<option value="'+w+'">'+z+"</option>"});return t},e=function(v,s){var u=new Hash(v),t='<option value="">请选择'+s+"</option>";u.each(function(z,A){var w=A.split("_");t=t+'<option value="'+(w[1]||w[0])+'" class="b">'+w[0]+"</option>";new Hash(z).each(function(C,B){t=t+'<option value="'+B+'" class="fs">&nbsp;&nbsp;'+C+"</option>"})});return t};if(i&&l&&q&&f&&b&&r&&d){f.addEvent("change",function(){new AjaxReq({url:this.attr("data-url")+this.val(),onSuccess:function(s){if(s.region){b.html(h(s.region,"地区"));b.getElement("option").attr("selected","selected")}if(s.food){q.html(e(s.food,"菜系"));q.getElement("option").attr("selected","selected")}}}).send()});$testRemind.bind();i.addEvent("click",function(){if($isEmpty(l)){$testRemind(l,"尚未输入商户名",true);l.focus()}else{if(l.val().length>100){$testRemind(l,"商户名不要超过100个字",true);l.focus();l.select()}else{if($isEmpty(c)){$testRemind(c,"尚未输入验证码",true);c.focus()}else{if(!f.val()){$testRemind(f,"尚未选择所在城市");f.focus()}else{if(!b.val()){$testRemind(b,"尚未选择所在地区");b.focus()}else{if($isEmpty(n)){$testRemind(n,"尚未输入详细地址",true);n.focus()}else{if(n.val().length>100){$testRemind(n,"详细地址不要超过100个字",true);n.select()}else{if(!q.val()){$testRemind(q,"尚未选择菜系");q.focus()}else{if(r.val().length>100){$testRemind(r,"营业时间内容不要超过100个字",true);r.select()}else{if(d.val().length>200){$testRemind(d,"公交信息不要超过200个字",true);d.select()}else{$formSubmit(this,{text:"添加中..."})}}}}}}}}}}return false})}};var $funPriv=function(){$lazyLoading($$(".jsLazyImage"));$autoRemind($("privEmail"));var b=$("privEmail"),a=$$(".privEmailBtn");if(b&&a){a.addEvent("click",function(){var c=b.val().trim();$testRemind.bind();if($verifyRefer.funTestEmail(b,true)){var e=this.attr("data-login"),d=this.attr("data-url");if(e){new AjaxPost(this,{url:d,data:{email:c},callback:function(){$testRemind.hide()}}).send()}}return false});$enterEvent(b,a)}};var $funChain=function(){$lazyLoading($$(".lazyImg"));var a=$$(".resChainList");if($isIe6){a.addEvents({mouseenter:function(){this.css("border-color","#ccc")},mouseleave:function(){this.css("border-color","#ebebeb")}})}var b=$$(".resChainNav");$tabSwitch(b,{eventType:"hover",classAdd:"res_chain_tab_on",classRemove:"res_chain_tab"});$customTip($$(".tipTrigger"));if(window.screen.width<=1024){if($isIe6){a.css("width","665px")}else{a.css("width","96%")}}};